!function(){"use strict";angular.module("sdx.agenda.globals",["sdx.envConfig","mm.foundation"])}(),function(){"use strict";function a(a,b){return{login:a+"/Login/",buscarPaciente:a+"/BuscarPaciente/",obtenerDisponibilidad:a+"/ObtenerDisponibilidad/",notificarCitaNueva:a+"/NotificarCitaNueva/",editarInformacionPaciente:a+"/EditarInformacionPaciente/",crearTelefonoPaciente:a+"/CrearTelefonoPaciente/",anularCita:a+"/AnularCita/",obtenerCitasFuturas:a+"/ObtenerCitasFuturas/",buscarProfesional:a+"/BuscarProfesional/",obtenerCitasAgendadas:a+"/ObtenerCitasAgendadas/",rechazarCita:a+"/RechazarCita",crearCaso:a+"/CrearCaso",agendarCita:a+"/AgendarCita",cerrarCaso:a+"/CerrarCaso",enviarCorreo:a+"/NotificarCita",obtenerEstablecimiento:a+"/ObtenerEstablecimiento",obtenerCentroContacto:a+"/ObtenerCentroContacto",crearCentroContacto:a+"/CrearCentroContacto",actualizarCentroContacto:a+"/ActualizarCentroContacto",obtenerContratos:a+"/ObtenerContratos",actualizarContrato:a+"/ActualizarContrato",obtenerListaTrabajo:a+"/ObtenerListaTrabajo",crearTelefonista:a+"/CrearTelefonista",actualizarTelefonista:a+"/ActualizarTelefonista",obtenerAlcanceCentroContacto:a+"/ObtenerAlcanceCentroContacto",obtenerCitasPorFiltro:a+"/ObtenerCitasPorFiltro",notificarCitaReagendada:a+"/NotificarCitaReagendada",jasperServer:b}}angular.module("sdx.agenda.globals").factory("RestEndpoints",a),a.$inject=["AGENDA_API_BASE","REPORTS_BASE"]}(),function(){"use strict";angular.module("sdx.agenda.globals").constant("PhoneTypes",{telephone:{label:"TEL1_FICHA_FAMILIAR",typeId:1},cellphone:{label:"MOVIL_FICHA_FAMILIAR",typeId:4}}).constant("HealthProblemsConst",{Alergias:"medicina general",Cefalea:"neuro","Colon Irritable":"medicina general",Diabetes:"medicina general",Diarrea:"medicina general","Hipertensión Arterial":"cardio",Infertilidad:"gine","Obesidad y Nutrición":"medicina general","Patología Mamaría":"gine"})}(),function(){"use strict";function a(){this.list=[],this.listAux=[]}function b(a,b){this.filter=function(c,d){var e,f=(d.date||"").trim();f?(e=[],f=f.split(/\//g),c.forEach(function(a){parseInt(f[2])===new Date(a.date).getFullYear()&&parseInt(f[1])-1===new Date(a.date).getMonth()&&parseInt(f[0])===new Date(a.date).getDate()&&e.push(a)})):e=c,b.listAux=a("filterObj")(c,void 0,"healthCareCenter",d.healthCareCenter,"specialty",d.specialty,"professional",d.professional),b.list=a("filterObj")(e,void 0,"healthCareCenter",d.healthCareCenter,"specialty",d.specialty,"professional",d.professional);var g=[],h={};b.list.forEach(function(a){h[a.specialty]||(h[a.specialty]={}),h[a.specialty][a.professional]||(h[a.specialty][a.professional]={}),h[a.specialty][a.professional][a.typeAttention]||(h[a.specialty][a.professional][a.typeAttention]=[]),h[a.specialty][a.professional][a.typeAttention].push(a)});for(var i in h)if(h.hasOwnProperty(i))for(var j in h[i])if(h[i].hasOwnProperty(j))for(var k in h[i][j])h[i][j].hasOwnProperty(k)&&g.push(h[i][j][k]);return g}}angular.module("sdx.agenda.globals").service("appointmentsDrive",a).service("aDriver",b),a.$inject=[],b.$inject=["$filter","appointmentsDrive"]}(),function(){"use strict";function a(a,b,c,d){return{link:function(e,f,g){var h=!0,i=a.state;i.appointmentsStart||(i.appointmentsStart=new Date),$(f).is("input, textarea, select")||$(f).attr("data-date",c("date")(i.appointmentsStart,"dd/MM/yyyy")),$(f).fdatepicker({language:"es",format:"dd/mm/yyyy",weekStart:1,onRender:function(a){for(var b=d.getList(),c=0;c<b.length;c++){var e=b[c].date;"string"==typeof e&&(e=new Date(e));var f=new Date(e);if(f.setDate(f.getDate()-1),a.getFullYear()===f.getFullYear()&&a.getMonth()===f.getMonth()&&a.getDate()===f.getDate())return""}return"disabled"}}).on("changeDate",function(a){h=!1,i.appointmentsStart=new Date(a.date.setDate(a.date.getDate()+1)),b.$emit("changeAppointmentStart")}),$(f).fdatepicker("update",i.appointmentsStart),b.$on("datePickerUpdate",function(a,b){var c=new Date(b);c.setDate(c.getDate()-1),c.setHours(21),c.setMinutes(0),c.setSeconds(0),c.setMilliseconds(0),$(f).fdatepicker("update",c)})}}}angular.module("sdx.agenda.globals").directive("fDatepicker",a),a.$inject=["PatientSession","$rootScope","$filter","AppointmentsService"]}(),function(){"use strict";function a(a,c,d){function e(b,d,e){b.asc.element=d;var f=b.asc.appointments;$(d).children("div").eq(0).attr("data-date",c("date")(b.asc.startAppointmentsDay,"dd/MM/yyyy")),$(d).children("div").eq(0).fdatepicker({language:"es",weekStart:1,format:"dd/mm/yyyy",onRender:function(a){for(var b=0;b<f.length;b++){var c=f[b].date,d=new Date(c);if(d.setDate(d.getDate()-1),a.getFullYear()===d.getFullYear()&&a.getMonth()===d.getMonth()&&a.getDate()===d.getDate())return""}return"disabled"}}).on("changeDate",function(c){b.asc.startAppointmentsDay=new Date(c.date.setDate(c.date.getDate()+1)),b.asc.organizeAppointments(),a.$apply()})}return{link:e,restrict:"EA",scope:{appointments:"=appointments",selectedAppointment:"=selectedAppointment"},templateUrl:d+"/scripts/globals/directives/appointments-selection/appointments-selection.html",controller:b,controllerAs:"asc",bindToController:!0}}function b(a,b,c){function d(){var a,b=[],c=new Date(g.startAppointmentsDay);for(a=0;7>a;a++)b.push(new Date(c)),c.setDate(c.getDate()+1);var d=[],e={},f={},h=new Date(g.startAppointmentsDay);h.setHours(0),h.setMinutes(0),h.setSeconds(0);var i=new Date(g.startAppointmentsDay);i.setDate(i.getDate()+6),i.setHours(23),i.setMinutes(59),i.setSeconds(59),g.appointments.forEach(function(a){if(a.date<h||a.date>i)return!1;var b=a.date.getHours();b=(10>b?"0":"")+b;var c=a.date.getMinutes();c=(10>c?"0":"")+c,f[b+":"+c]||(f[b+":"+c]=[!1,!1,!1,!1,!1,!1,!1])});var j=Object.keys(f),k=j.length;for(j.sort(),a=0;k>a;a++){var l=j[a];e[l]=f[l]}g.appointments.forEach(function(a){var c=a.date.getHours();c=(10>c?"0":"")+c;var f=a.date.getMinutes();f=(10>f?"0":"")+f,b.forEach(function(b,g){b.getFullYear()===a.date.getFullYear()&&b.getMonth()===a.date.getMonth()&&b.getDate()===a.date.getDate()&&(e[c+":"+f][g]=a,d.push(a))})}),g.orderedAppointmentsDays=b,g.orderedAppointments=e,g.filteredAppointments=d}function e(){var a=new Date(g.startAppointmentsDay);a.setDate(a.getDate()-7),g.startAppointmentsDay=a,$(g.element).children("div").eq(0).fdatepicker("update",c("date")(a,"dd/MM/yyyy")),g.organizeAppointments()}function f(){var a=new Date(g.startAppointmentsDay);a.setDate(a.getDate()+7),g.startAppointmentsDay=a,$(g.element).children("div").eq(0).fdatepicker("update",c("date")(a,"dd/MM/yyyy")),g.organizeAppointments()}var g=this;g.organizeAppointments=d,g.prevWeek=e,g.nextWeek=f,g.appointments=c("orderBy")(g.appointments,"date"),g.startAppointmentsDay=g.appointments[0]?g.appointments[0].date:new Date,d(),g.setSelectedAppointment=function(a){g.selectedAppointment=a}}angular.module("sdx.agenda.globals").directive("appointmentsSelection",a),a.$inject=["$rootScope","$filter","BASE_PATH"],b.$inject=["$scope","$parse","$filter"]}(),function(){"use strict";function a(){return{template:'<div class="sk-fading-circle"><div class="sk-circle1 sk-circle"></div><div class="sk-circle2 sk-circle"></div><div class="sk-circle3 sk-circle"></div><div class="sk-circle4 sk-circle"></div><div class="sk-circle5 sk-circle"></div><div class="sk-circle6 sk-circle"></div><div class="sk-circle7 sk-circle"></div><div class="sk-circle8 sk-circle"></div><div class="sk-circle9 sk-circle"></div><div class="sk-circle10 sk-circle"></div><div class="sk-circle11 sk-circle"></div><div class="sk-circle12 sk-circle"></div></div>',link:function(a,b,c){$(b).find(".sk-circle").addClass(c.loadIcon)}}}angular.module("sdx.agenda.globals").directive("loadIcon",a),a.$inject=[]}(),function(){"use strict";function a(){return{link:function(a,b,c){$(b).click(function(){c.cModal&&$(this).parents(".reveal-modal").removeClass("tiny").removeClass("small").removeClass("medium").removeClass("large").removeClass("largee").removeClass("xlarge").removeClass("full").removeClass("mediumm").addClass(c.cModal)})}}}angular.module("sdx.agenda.globals").directive("cModal",a),a.$inject=[]}(),function(){"use strict";function a(a){return{link:function(b,c,d){b.$watch(d.ngAutofocus,function(b){angular.isDefined(b)&&b&&a(function(){c[0].focus()})},!0)}}}angular.module("sdx.agenda.globals").directive("ngAutofocus",a),a.$inject=["$timeout"]}(),function(){function a(){return function(a,c){if(c=c?c:"format","format"===c){var d=b(a),e=d[0],f=d[1];if(!e||!f)return"";for(var g="";e.length>3;)g="."+e.substr(e.length-3)+g,e=e.substring(0,e.length-3);return(e+g+"-"+f).toLowerCase()}if("validate"===c){for(var h=a.replace(/\./g,"").split(/\-/),i=parseInt(h[0]),j=0,k=1;i;i=Math.floor(i/10))k=(k+i%10*(9-j++%6))%11;var l=k?k-1:"k";return String(l)===h[1]}}}function b(a){var b=(a||"").replace(/[\.\-]/g,"");if(0===b.length)return[null,null];if(1===b.length)return[b,null];var c=b.charAt(b.length-1),d=b.substring(0,b.length-1);return[d,c]}angular.module("sdx.agenda.globals").filter("RunFormatFilter",a),a.$inject=[]}(),function(){"use strict";function a(){return function(a,b){if(!a)return a;var c={Monday:"Lunes",Tuesday:"Martes",Wednesday:"Miércoles",Thursday:"Jueves",Friday:"Viernes",Saturday:"Sábado",Sunday:"Domingo"};if(b){for(var d in c)c.hasOwnProperty(d)&&(a=a.replace(d,c[d]));return a}return c[a]||a}}angular.module("sdx.agenda.globals").filter("NameOfDayFilter",a),a.$inject=[]}(),function(){"use strict";function a(){return function(a,b){if("string"==typeof b&&"clear"===b)return a.replace(/^\+56[2|9]/,"");if(b)return/^\+56[2|9][0-9]{8}$/.test(a);if(a){a=a.replace(/^\+56[0-9]/,"");/^2/.test(a)?"2":"9";return"+56 "+a}return""}}angular.module("sdx.agenda.globals").filter("TelephoneFilter",a),a.$inject=[]}(),function(){"use strict";function a(){return function(a,b,c,d,e,f,g,h,i,j){var k=[],l={};return a&&a.forEach(function(a){if(c&&d&&a[c]!==d)return!1;if(e&&f&&a[e]!==f)return!1;if(g&&h&&a[g]!==h)return!1;if(i&&j&&a[i]!==j)return!1;if(b){var m=a[b];l[m]||(l[m]=!0,k.push(m))}else k.push(a)}),k}}angular.module("sdx.agenda.globals").filter("filterObj",a),a.$inject=[]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){var i=this;i.BASE_PATH=f,i.appointment=d,i.appointments=[],i.appointmentsFiltered=[],i.appointmentsLoaded=!1,i.error={},i.setData=function(){i.email=angular.copy(d.patient.email),i.telephone=angular.copy(d.patient.telephone),i.cellphone=angular.copy(d.patient.cellphone),i.areaCode=angular.copy(d.patient.telephoneAreaCode)},i.setData(),i.organizeAppointmentsMobile=function(){var a=i.appointments,b={},c=[],d=new Date;a.forEach(function(a){if(a.date>d){var c=a.date.getFullYear()+a.date.getMonth()+a.date.getDate();b[c]||(b[c]=[]),b[c].push(a)}});for(var e in b)b.hasOwnProperty(e)&&c.push(b[e]);i.appointmentsHoursMobile=c},i.selectedAppointmentInAppointments=function(a){for(var b=0;b<a.length;b++)if(i.appointment===a[b])return!0;return!1},i.loadAppointments=function(){return i.appointmentsLoaded?!1:(i.loading=!0,g.availablesForReschedule(d).then(function(a){i.loading=!1,i.appointments=a,i.appointmentsLoaded=!0,i.appointmentsFiltered=e.filter(i.appointments,{}),i.organizeAppointmentsMobile()},function(a){i.loading=!1,b.warning("Ha ocurrido un error al cargar las citas disponibles","Atención")}))};var j=function(a){return i.appointment.patient.email?g.sendEmail(a,i.appointment.patient).then(function(){b.success("Comprobante enviado correctamente.","Información")},function(a){b.warning(a,"Atención")}):void b.warning("No tienes un correo electrónico registrado.","Datos de contacto")};return i.confirm=function(){i.loading=!0;var d=b.info("Actualizando datos","Confirmar",c);return g.confirm(i.appointment,"confirm",void 0,i.appointment.idQuota||-1).then(function(){return b.success("La cita fue confirmada correctamente.","Confirmar"),a.close()},function(){i.loading=!1,b.warning("Ha ocurrido un error al confirmar la cita","Confirmar")})["finally"](function(){b.clear(d)})},i.cancel=function(){i.loading=!0;var e=b.info("Actualizando datos","Anular cita",c);return g.cancel(d,"cancel").then(function(){b.success("La cita fue anulada correctamente.","Anular cita"),a.close()},function(){i.loading=!1,b.warning("Ha ocurrido un error al anular la cita","Anular cita")})["finally"](function(){b.clear(e)})},i.reschedule=function(e,f){if(!e)return b.warning("Debes elegir una cita para poder reagendar.","Atención"),!1;i.loading=!0;var h=b.info("Actualizando datos","Reagendar",c);return g.reschedule(d,"reschedule",e).then(function(c){b.success("La cita se reagendó correctamente.","Reagendar"),f&&j(c.IdentificadorCita),a.close()},function(a){i.loading=!1,b.warning("Ha ocurrido un error al anular la cita","Reagendar")})["finally"](function(){b.clear(h)})},i.changeDataPatient=function(a,e,f){i.loading=!0;var g=b.info("Actualizando datos","Datos de contacto",c);h.updateContactData(d.patient,e,f,a).then(function(){i.setData(),b.success("Datos actualizados con éxito","Datos de contacto")},function(a){b.error("Ha ocurrido algo inesperado","Datos de contacto")})["finally"](function(){b.clear(g),i.loading=!1})},i}angular.module("sdx.agenda.modals",["sdx.agenda.globals","sdx.agenda.appointments"]).controller("modalEditAppointment",a),a.$inject=["$modalInstance","toastr","toastrNoDismiss","appointment","aDriver","BASE_PATH","AppointmentsService","PatientService"]}(),function(){"use strict";angular.module("sdx.agenda.appointments",["sdx.agenda.globals"])}(),function(){"use strict";function a(a,b,c,d,e){var f=this;f.appointments=[],f.appointmentsLoaded=!1,f.HTTP_CONFIG={headers:{"Content-Type":"text/json"}},f.anularCita=function(d){return a.post(c.anularCita,{IdentificadorCitaRechazada:d.IdentificadorCita},f.HTTP_CONFIG)["catch"](function(){return b.reject({type:"error",msg:"Ha ocurrido un error al agendar la cita"})})};var g={newResource:function(){return{id:null,date:null,typeAttention:null,specialty:null,professional:{id:null,name:null}}},load:function(e){return a.post(c.obtenerDisponibilidad,{FechaInicio:d("date")(new Date,"yyyyMMdd"),IdsNodo:e.healthCareCenter.id,IdentificadorPaciente:e.id},f.HTTP_CONFIG).then(function(a){return a.data.hasOwnProperty("TypeCupo")?(angular.isArray(a.data.TypeCupo)||(a.data.TypeCupo?a.data.TypeCupo=[a.data.TypeCupo]:a.data.TypeCupo=[]),a.data.TypeCupo.forEach(function(a){var b=parseInt(a.Fecha.substring(0,4)),c=parseInt(a.Fecha.substring(4,6))-1,d=parseInt(a.Fecha.substring(6,8)),e=parseInt(a.Hora.split(/\:/g)[1]),g=parseInt(a.Hora.split(/\:/g)[0]);f.appointments.push({id:parseInt(a.IdCupo),professional:{name:a.NombreMedico+" "+a.ApPaternoMedico,id:parseInt(a.IdMedico)},specialty:a.Especialidad,typeAttention:a.TipoAtencion,date:new Date(b,c,d,g,e),healthCareCenter:{id:a.IdNodo}})}),f.appointmentsLoaded=!0,f.appointments):b.reject()})},getList:function(a,c){return f.appointmentsLoaded&&!c?b.resolve(f.appointments):g.load(a).then(function(){return f.appointments})},getListFuture:function(a){return f.appointmentsFutureLoaded?f.futureAppointments:g.loadFutures(a).then(function(){return f.futureAppointments})},make:function(e,g,h){return a.post(c.notificarCitaNueva,{FechaEnteraCupo:d("date")(new Date(e.date),"yyyyMMdd"),IdCupo:e.id,IdPaciente:g,Fecha:d("date")(new Date(e.date),"yyyy-MM-dd HH:mm"),IdNodo:e.healthCareCenter.id,Comentario:e.healthCareCenter.id},f.HTTP_CONFIG).then(function(a){return a.data&&a.data.RespuestaBase&&a.data.RespuestaBase.hasOwnProperty("Estatus")?0!==parseInt(a.data.RespuestaBase.Estatus)?b.reject({type:"warning",msg:a.data.RespuestaBase.Descripcion}):{IdentificadorCita:a.data.IdentificadorCita,IdCaso:a.data.IdCaso,IdCupo:a.data.IdCupo}:b.reject({type:"error",msg:"Ha ocurrido un error en el servidor. Por favor intente más tarde"})})},loadFutures:function(d){return a({method:"POST",url:c.obtenerListaTrabajo,headers:{"Content-Type":"text/json"},data:JSON.stringify({IdPaciente:d.id})}).then(function(a){var c=a.data;if(c.RespuestaBase&&0===c.RespuestaBase.Estatus){var e=[],g={};c.Citas.forEach(function(a){if(!a.FechaCita)return!1;if(parseInt(a.IdPaciente)!==parseInt(d.id))return!1;var b=parseInt(a.FechaCita.substring(0,4)),c=parseInt(a.FechaCita.substring(4,6))-1,e=parseInt(a.FechaCita.substring(6,8)),f=parseInt(a.HoraCita.split(/\:/g)[1]),h=parseInt(a.HoraCita.split(/\:/g)[0]);g[a.IdCita]={id:a.IdCita,idQuota:a.IdCupo,status:a.EstadoSonia,idCase:a.IdCaso,date:new Date(b,c,e,h,f),patient:{id:a.IdPaciente,run:a.RutPaciente,name:a.NombrePaciente,cellphone:a.MOVIL_CONTACTO||a.MOVIL_FICHA_FAMILIAR,tagCelhone:a.MOVIL_CONTACTO?"MOVIL_FICHA_FAMILIAR":a.MOVIL_FICHA_FAMILIAR?"MOVIL_FICHA_FAMILIAR":"",telephone:a.TEL1_CONTACTO||a.TEL1_FICHA_FAMILIAR,tagTelephone:a.TEL1_CONTACTO?"TEL1_FICHA_FAMILIAR":a.TEL1_FICHA_FAMILIAR?"TEL_FICHA_FAMILIAR":"",email:a.Email,telephoneAreaCode:a.TEL1_CONTACTO_CODIGO_AREA,telephoneCountryCode:a.TEL1_CONTACTO_CODIGO_PAIS},healthCareCenter:{id:a.IdNodo,name:a.Nodo},specialty:{id:a.IdEspecialidad,name:a.Especialidad},typeAttention:{id:0,name:a.TipoAtencion},professional:{id:0,name:a.Profesional}}});for(var h in g)g.hasOwnProperty(h)&&e.push(g[h]);return f.futureAppointments=e,e}return b.reject("Ha ocurrido un error al cargar las citas agendadas")})},availablesForReschedule:function(e){return a({method:"POST",url:c.obtenerDisponibilidad,headers:{"Content-Type":"text/json"},data:JSON.stringify({FechaInicio:d("date")(new Date,"yyyyMMdd"),IdsNodo:e.healthCareCenter.id,IdentificadorPaciente:e.patient.id})}).then(function(a){var c=a.data,d=[];return c?(angular.isArray(c.TypeCupo)||(c.TypeCupo?c.TypeCupo=[c.TypeCupo]:c.TypeCupo=[]),c.TypeCupo.forEach(function(a){if(a.Especialidad.toLowerCase()!==e.specialty.name.toLowerCase()||a.TipoAtencion.toLowerCase()!==e.typeAttention.name.toLowerCase())return!1;var b=parseInt(a.Fecha.substring(0,4)),c=parseInt(a.Fecha.substring(4,6))-1,f=parseInt(a.Fecha.substring(6,8)),g=parseInt(a.Hora.split(/\:/g)[1]),h=parseInt(a.Hora.split(/\:/g)[0]);d.push({id:parseInt(a.IdCupo),healthCareCenter:parseInt(a.IdNodo),professional:a.NombreMedico+" "+a.ApPaternoMedico,specialty:a.Especialidad,typeAttention:a.TipoAtencion,date:new Date(b,c,f,h,g)})}),d):b.reject("Ha ocurrido un error al cargar las citas disponibles")})},sendEmail:function(d,e){return a({method:"POST",url:c.enviarCorreo,headers:{"Content-Type":"text/json"},data:JSON.stringify({idCita:d,idPaciente:e.id,rutPaciente:e.run})}).then(function(a){try{var c=a.data;return 0===c.RespuestaBase.Estatus?!0:b.reject("Ha ocurrido algo inesperado")}catch(d){return b.reject("Ha ocurrido algo inesperado")}},function(a){return b.reject("Ha ocurrido un error al enviar el correo electrónico.")})},confirm:function(d,g,h,i){var j;switch(g){case"confirm":j=e.Confirmada;break;case"cancel":j=e.Cancelada;break;default:j=e.Reagendada}return a.post(c.agendarCita,{IdCaso:d.idCase,IdCita:h||d.id,IdCupo:i,IdEstadoCita:j,Comentario:d.healthCareCenter.id},f.HTTP_CONFIG).then(function(a){var c=a.data;0===c.RespuestaBase.Estatus&&b.resolve()})},cancel:function(d,e){return a.post(c.anularCita,{IdentificadorCitaRechazada:d.id},f.HTTP_CONFIG).then(function(a){var c=a.data;0===c.Estatus?b.resolve():b.reject("Ha ocurrido un error al anular la cita")})},reschedule:function(e,g,h){return a.post(c.notificarCitaReagendada,{FechaEnteraCupo:d("date")(new Date(h.date),"yyyyMMdd"),IdCupo:h.id,IdPaciente:e.patient.id,Fecha:d("date")(new Date(h.date),"yyyy-MM-dd HH:mm"),IdCitaEliminada:e.id,IdNodo:e.healthCareCenter.id},f.HTTP_CONFIG).then(function(a){var c=a.data;0!==parseInt(c.Estatus)?b.reject("Ha ocurrido un error al anular la cita"):b.resolve()})}};return g}angular.module("sdx.agenda.appointments").constant("EstadoCitaConst",{Agendada:1,Confirmada:2,Cancelada:3,Reagendada:4}).factory("AppointmentsService",a),a.$inject=["$http","$q","RestEndpoints","$filter","EstadoCitaConst"]}(),function(){"use strict";angular.module("sdx.agenda.patient",["sdx.agenda.globals"])}(),function(){"use strict";function a(a,b,c,d){var e=this;e.newPhone=function(e,f,g){return a({method:"POST",url:b.crearTelefonoPaciente,headers:{"Content-Type":"text/json"},data:JSON.stringify({Telefono:e,IdPaciente:g.id,EtiquetaTelefono:d[f].label,TipoTelefono:d[f].typeId,CodArea:"",CodPais:"56"})}).then(function(a){var b=a.data;0===parseInt(b.Estatus)?g[f]=e:c.reject()})},e.editPhoneEmail=function(e,f,g,h){return a({method:"POST",url:b.editarInformacionPaciente,headers:{"Content-Type":"text/json"},data:JSON.stringify({Email:g||"",EtiquetaTelefono:d[f].label,IdPaciente:h.id,Telefono:e||"",CodigoArea:"0"})}).then(function(a){var b=a.data;return 0===parseInt(b.Estatus)?(h.email=g,void(h[f]=e)):void c.reject()})};var f={getContactDataCopy:function(a){return{email:a.email,telephone:a.telephone,cellphone:a.cellphone,areaCode:String(a.telephoneAreaCode)||"2",countryCode:String(a.telephoneCountryCode)||"56"}},updateContactData:function(a,b,d,f){a.telephone=a.telephone.toString(),b=b.toString();var g=[];return a.telephone!==b&&(a.telephone?g.push(e.editPhoneEmail(b,"telephone",f,a)):g.push(e.newPhone(b,"telephone",a))),a.cellphone!==d&&(a.cellphone?g.push(e.editPhoneEmail(d,"cellphone",f,a)):g.push(e.newPhone(b,"cellphone",a))),g.length||a.email.toString()===f.toString()||g.push(e.editPhoneEmail(b,"telephone",f,a)),c.all(g)},updateEmail:function(a,b){return e.editPhoneEmail(a.telephone,"telephone",b,a)},getFromApi:function(a){var b={};return angular.isObject(a)?(b.id=parseInt(a.Id_Paciente),b.name=a.Nombres+" "+a.Ap_Paterno+" "+a.Ap_Materno,b.run=a.Rut,b.healthCareCenter={},b.healthCareCenter.id=parseInt(a.Id_nodo),b.healthCareCenter.name=a.Nodo,b.section=a.section,b.email=a.Email,b.telephone=a.Tel_Contacto,b.cellphone=a.Movil_Contacto,b.telephoneAreaCode=a.Tel_Contacto_Codigo_Area,b.telephoneCountryCode=a.Tel_Contacto_Codigo_Pais,b):b},isValidData:function(a,b){return b&&a&&b.FechaNacimiento&&a&&parseInt(a)!==parseInt(b.Id_Paciente)}};return f}angular.module("sdx.agenda.patient").factory("PatientService",a),a.$inject=["$http","RestEndpoints","$q","PhoneTypes"]}(),function(){"use strict";angular.module("sdx.agenda.patientSession",["base64","sdx.agenda.globals","sdx.agenda.patient"])}(),function(){"use strict";function a(a,b,c,d,e,f,g){var h=this;h.state={finished:!1,step:1,section:"specialty",prev:{step:0},origin:null},h.selectedAppointment=null,h.patient=null,e.onbeforeunload=function(){localStorage.ss=a.encode(JSON.stringify({state:h.state,patient:h.patient,sa:h.selectedAppointment})),h.stopAutoLogout()},h.logout=function(){var a;a=h.state.origin&&i.test(h.state.origin)?h.state.origin:"../autentificacion/#/publico",h.selectedAppointment=null,h.patient=null,h.state=null,e.location.href=a},h.startAutoLogout=function(){var a=new Date(h.state.timeStart.getTime()+6e4*g),b=a-new Date;0>=b&&h.logout(),h.autoLogout=e.setTimeout(function(){h.logout()},b)},h.stopAutoLogout=function(){h.autoLogout&&e.clearTimeout(h.autoLogout)};var i=/^(https?:\/\/)?((([a-z\d]([a-z\d-]*[a-z\d])*)\.)+[a-z]{2,}|((\d{1,3}\.){3}\d{1,3}))(\:\d+)?(\/[-a-z\d%_.~+]*)*(\?[;&a-z\d%_.~+=-]*)?(\#[-a-z\d_]*)?$/i;return{state:function(){return h.state},selectedAppointment:function(){return h.selectedAppointment},setSelectedAppointment:function(a){return h.selectedAppointment=a,h.selectedAppointment},patient:function(){return h.patient},auth:function(a,e){return a.birthday?(a.birthday=a.birthday.split(/\//g),a.birthday.forEach(function(b,c){a.birthday[c]=parseInt(b)<10?"0"+parseInt(b):b}),a.birthday=a.birthday.join("/")):a.birthday="",h.state.origin=e,c({method:"POST",url:b.buscarPaciente,headers:{"Content-Type":"text/json"},data:{Rut:a.run.replace(/[\-\.]/g,"").toLowerCase().trim(),FechaNacimiento:a.birthday}}).then(function(b){var c=b.data;return console.log(b),console.log(c.length),console.log(c.Id_Paciente),void 0==c.Id_Paciente?d.reject("RUN y/o fecha de nacimiento incorrectos, o su establecimiento no tiene habilitado este servicio."):f.isValidData(a.id,c)?d.reject("Paciente no encontrado."):(h.patient=f.getFromApi(c),h.patient)})},load:function(){if(localStorage.ss){var b=angular.fromJson(a.decode(localStorage.ss));h.state=b.state,h.state.timeStart&&(h.state.timeStart=new Date(h.state.timeStart)),h.patient=b.patient,h.selectedAppointment=b.sa,localStorage.removeItem("ss")}return d.resolve()},logout:function(){h.logout()},"goto":function(a,b){var c;switch(a){case"confirmar":h.state.section="confirmar",c="../agendamiento/#/confirmar";break;default:c="../agendamiento/"}h.state.typeAttention=b,h.state.timeStart=new Date,e.top.location=c},clear:function(){h.state.appointmentsStart=void 0,h.selectedAppointment=void 0,h.state.step=h.state.prev.step||1,h.state.prev.step=void 0},startSession:function(){h.stopAutoLogout(),h.startAutoLogout()}}}angular.module("sdx.agenda.patientSession").factory("PatientSession",a),a.$inject=["$base64","RestEndpoints","$http","$q","$window","PatientService","TIME_LIMIT_PATIENT_SESSION"]}(),function(){"use strict";function a(a,b,e,f,g,h){e.debugInfoEnabled(g),f.debugEnabled(g),b.otherwise("/"),a.state("no-citas",{url:"/no-citas",views:{main:{templateUrl:"no-citas.html",controller:"NoCitasController",controllerAs:"ncc"}}}).state("agendamiento",{url:"/",resolve:{patient:["PatientSession",function(a){return a.load().then(function(){return a.patient()})}],session:["patient","PatientSession",function(a,b){return b.startSession()}],appointments:c},views:{main:{templateUrl:"main.html",controller:"AgendamientoController",controllerAs:"vm"},"header@agendamiento":{templateUrl:"header.html"},"pasos@agendamiento":{templateUrl:"pasos.html"},"paso1.especialidad@agendamiento":{templateUrl:"pasos/paso1.especialidad.html"},"paso1.profesional@agendamiento":{templateUrl:"pasos/paso1.profesional.html"},"paso1.problema@agendamiento":{templateUrl:"pasos/paso1.problema.html"},"paso2@agendamiento":{templateUrl:"pasos/paso2.html"},"paso3@agendamiento":{templateUrl:"pasos/paso3.html"}}}).state("confirmar",{url:"/confirmar",resolve:{patient:["PatientSession",function(a){return a.load().then(function(){return a.patient()})}],session:["patient","PatientSession",function(a,b){return b.startSession()}],futureAppointments:d},views:{main:{templateUrl:"main.html",controller:"anularCitaController",controllerAs:"acc"},"header@confirmar":{templateUrl:"headerAnular.html"},"pasos@confirmar":{templateUrl:"anularCita.html"}}}),angular.extend(h,{autoDismiss:!0,closeButton:!0,positionClass:"toast-top-right",progressBar:!0,timeOut:7e3})}function b(a,b,c,d,e){a.$on("$stateChangeStart",function(a,d,f,g){return e.debug("$stateChangeStart to "+d.to+"- fired when the transition begins. toState,toParams : \n",d,f),b.load().then(function(){b.patient()&&b.patient().id||(c.location.href="../autentificacion/#/publico")}),!0}),d&&(a.$on("$stateChangeError",function(a,b,c,d,f){e.debug("$stateChangeError - fired when an error occurs during transition."),e.debug(arguments)}),a.$on("$stateChangeSuccess",function(a,b,c,d,f){e.debug("$stateChangeSuccess to "+b.name+"- fired once the state transition is complete.")}),a.$on("$viewContentLoaded",function(a){e.debug("$viewContentLoaded - fired after dom rendered",a)}),a.$on("$stateNotFound",function(a,b,c,d){e.debug("$stateNotFound "+b.to+"  - fired when a state cannot be found by its name."),e.debug(b,c,d)}))}function c(a,b,c,d,e,f,g){var h=c.info("Cargando datos","Citas disponibles",d);return b.getList(a.patient())["finally"](function(){c.clear(h)})["catch"](function(a){return f.go("no-citas"),e.reject(a)})}function d(a,b,c,d,e,f){var g=c.info("Cargando datos","Citas agendadas",d);return b.getListFuture(a.patient())["finally"](function(){c.clear(g)})["catch"](function(a){return c.warning("Ha ocurrido un error al cargar las citas agendadas","Atención"),e.reject(a)})}angular.module("sdx.agenda.agendamiento",["ui.router","base64","toastr","ngMessages","mm.foundation","sdx.agenda.globals","sdx.agenda.appointments","sdx.agenda.patient","sdx.agenda.patientSession","sdx.agenda.modals"]).config(a).run(b).constant("toastrNoDismiss",{autoDismiss:!1,closeButton:!1,progressBar:!1,timeOut:0,tapToDismiss:!1}),a.$inject=["$stateProvider","$urlRouterProvider","$compileProvider","$logProvider","DEBUG","toastrConfig"],b.$inject=["$rootScope","PatientSession","$window","DEBUG","$log"],c.$inject=["PatientSession","AppointmentsService","toastr","toastrNoDismiss","$q","$state","patient"],d.$inject=["PatientSession","AppointmentsService","toastr","toastrNoDismiss","$q","patient"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j){function k(a,b){return a.date>b.date?1:a.date<b.date?-1:0}var l=this;l.patient=h.patient(),l.state=h.state(),l.state.step=1,l.appointments=i,l.selectedAppointment=null,l.filteredAppointments=[],l.filteredAppointmentsMobile={},l.lastFilteredCache={},l.typesAttentions=[],l.professionals=[],l.specialties=[],l.healthProblems=e,l.loadAppointments=function(){l.filteredAppointments=[],l.filter()},l.filter=function(a,b,c,d){var e=[],f=[];b?l.appointments.forEach(function(a){if(l.healthProblems[b]){var c="string"==typeof l.healthProblems[b]?[l.healthProblems[b]]:Array.isArray(l.healthProblems[b])?l.healthProblems[b]:[],d=0;c.forEach(function(b){var c=new RegExp(b,"gi");(c.test(a.specialty)||c.test(a.typeAttention))&&d++}),d===c.length&&e.push(a)}}):e=l.appointments,!(l.typesAttentions.length<=1&&l.professionals.length<=1&&l.specialties.length<=1)||l.specialtyFiltered&&l.typeAttentionFiltered&&l.professionalFiltered||c?1!==l.typesAttentions.length||1!==l.professionals.length||1!==l.specialties.length||l.specialtyFiltered&&l.typeAttentionFiltered&&l.professionalFiltered||!c||(l.specialtyFiltered=l.specialties[0],l.typeAttentionFiltered=l.typesAttentions[0],"professional"!==a&&(l.professionalFiltered=l.professionals[0])):(l.specialtyFiltered=void 0,l.typeAttentionFiltered=void 0,"professional"!==a&&(l.professionalFiltered=void 0)),d&&(l.specialtyFiltered=void 0,l.typeAttentionFiltered=void 0,l.professionalFiltered=void 0),e.forEach(function(b){return l.specialtyFiltered&&l.specialtyFiltered!==b.specialty?!1:l.typeAttentionFiltered&&l.typeAttentionFiltered!==b.typeAttention?!1:"professional"!==a&&l.professionalFiltered&&l.professionalFiltered!==b.professional.name?!1:void f.push(b)});var g=[],h={},i={},j={},m={};f.forEach(function(a){i[a.typeAttention]=!0,j[a.professional.name]=!0,m[a.specialty]=!0,h[a.specialty]||(h[a.specialty]={}),h[a.specialty][a.typeAttention]||(h[a.specialty][a.typeAttention]={}),h[a.specialty][a.typeAttention][a.professional.name]||(h[a.specialty][a.typeAttention][a.professional.name]=[]),h[a.specialty][a.typeAttention][a.professional.name].push(a)});for(var n in h)if(h.hasOwnProperty(n))for(var o in h[n])if(h[n].hasOwnProperty(o))for(var p in h[n][o])h[n][o].hasOwnProperty(p)&&(h[n][o][p].sort(k),g.push(h[n][o][p]));l.filteredAppointments=g,l.lastFilteredCache=h,l.filterMobile(h),l.typesAttentions=[],l.professionals=[],l.specialties=[];for(n in i)i.hasOwnProperty(n)&&l.typesAttentions.push(n);for(n in j)j.hasOwnProperty(n)&&l.professionals.push(n);for(n in m)m.hasOwnProperty(n)&&l.specialties.push(n);l.typesAttentions.length<1&&l.professionals.length<1&&l.specialties.length<1&&b?(l.specialtyFiltered=void 0,l.typeAttentionFiltered=void 0,l.professionalFiltered=void 0):1===l.typesAttentions.length&&1===l.professionals.length&&1===l.specialties.length&&b&&(l.specialtyFiltered=l.specialties[0],l.typeAttentionFiltered=l.typesAttentions[0],l.professionalFiltered=l.professionals[0])},l.filterMobile=function(a){try{a=a||l.lastFilteredCache,l.specialtyFiltered&&(a=a[l.specialtyFiltered],l.typeAttentionFiltered&&(a=a[l.typeAttentionFiltered],l.professionalFiltered&&(a=a[l.professionalFiltered]))),l.filteredAppointmentsMobile=a}catch(b){}},l.setSelectedAppointment=function(a){l.selectedAppointment=h.setSelectedAppointment(a)},l.schedule=function(a,c){a&&l.setSelectedAppointment(a),l.selectedAppointment&&l.selectedAppointment.id?(l.error=!1,l.state.step=3,l.state.prev.step=c):b.warning("Debes de seleccionar una cita.","Atención")},l.viewDiary=function(a,c){if(c&&(l.state.appointmentsStart=new Date(c)),a){if(("professional"===l.state.section||"problem"===l.state.section)&&a.length>1)return b.warning("No deben haber filtros vacíos.","Atención"),
!1;"professional"===l.state.section||"problem"===l.state.section?a=a[0]:"specialty"===l.state.section&&a.length>1&&(l.selectedAppointment=a[0]),l.appointments=a,l.organizeAppointments(),l.organizeAppointmentsMobile(),l.state.step=2,l.state.prev.step=1}else b.warning("No se encuentra una agenda con esas caracteristicas","Atención")},l.scheduleSelectedAppointment=function(){l.loading=!0,l.error=null;var a=b.info("Agendando cita","Cita",c);f.make(l.selectedAppointment,h.patient().id,h.patient().healthCareCenter).then(function(a){l.selectedAppointment.successId=a.IdentificadorCita,l.state.finished=!0,b.success("Se agendó la cita correctamente","Cita")},function(a){l.error=a})["finally"](function(){l.loading=!1,b.clear(a)})},l.organizeAppointments=function(){l.appointmentsNames=[];for(var a={},b=[],c=l.appointments,d=[],e=l.state.appointmentsStart?new Date(l.state.appointmentsStart):new Date,f=0;7>f;f++)d.push(new Date(e)),e.setDate(e.getDate()+1);l.appointmentsNames=d,c.forEach(function(b){if(b.date>new Date&&b.date<e){var c=b.date.getHours()<10?"0"+b.date.getHours():b.date.getHours(),f=b.date.getMinutes()<10?"0"+b.date.getMinutes():b.date.getMinutes(),g=c+":"+f;a[g]||(a[g]=[!1,!1,!1,!1,!1,!1,!1]);for(var h=0;h<d.length;h++)d[h].getDate()===b.date.getDate()&&d[h].getMonth()===b.date.getMonth()&&d[h].getFullYear()===b.date.getFullYear()&&(a[g][h]=b)}});for(var g in a)a.hasOwnProperty(g)&&b.push({name:g,arr:a[g]});b.sort(function(a,b){return parseInt(a.name.replace(":",""))<parseInt(b.name.replace(":",""))?-1:parseInt(a.name.replace(":",""))>parseInt(b.name.replace(":",""))?1:0}),l.appointmentsHours=b},l.organizeAppointmentsMobile=function(){var a=l.appointments,b={},c=[];a.forEach(function(a){if(a.date>new Date){var c=a.date.getFullYear()+a.date.getMonth()+a.date.getDate();b[c]||(b[c]=[]),b[c].push(a)}});for(var d in b)b.hasOwnProperty(d)&&c.push(b[d]);l.appointmentsHoursMobile=c},l.changeWeek=function(a){var b=new Date(l.state.appointmentsStart)||new Date;b.setUTCDate(b.getUTCDate()+("prev"===a?-7:7)),l.state.appointmentsStart=b,d.$emit("datePickerUpdate",b),l.organizeAppointments()},d.$on("changeAppointmentStart",function(){d.$apply(function(){l.organizeAppointments()})}),l.printAppointment=function(){g.print()},l.sendEmail=function(){if(h.patient().email){l.loading=!0;var a=b.info("Enviando","Comprobante cita",c);return f.sendEmail(l.selectedAppointment.successId,h.patient()).then(function(){b.success("Comprobante enviado correctamente","Comprobante cita")},function(a){b.warning(a,"Comprobante cita")})["finally"](function(){b.clear(a),l.loading=!1})}b.warning("No tiene un correo electrónico registrado","Comprobante cita")},l.prev=function(){h.clear()},l.reset=function(a){l.healthProblem=null,l.typeAttentionFiltered=null,l.professionalFiltered=null,l.specialtyFiltered=null,l.state.appointmentsStart=void 0,a&&(l.state.section=a),l.state.step=1,h.selectedAppointment&&!l.state.finished&&(h.selectedAppointment=void 0)},l.searchProfessionalMethod=function(a){if(a===!1){var b={},c=[];l.filteredAppointments.forEach(function(a){a.forEach(function(a){new RegExp((l.professionalFiltered||"").toLowerCase()).test(a.professional.name.toLowerCase())&&(b[a.professional.name]=!0)})});for(var d in b)b.hasOwnProperty(d)&&c.push(d);return c}l.filter(void 0,void 0,l.professionalFiltered)},l.searchProfessionalMethodProf=function(a){if(a===!1){var b={},c=[];l.filteredAppointments.forEach(function(a){a.forEach(function(a){new RegExp((l.professionalFiltered||"").toLowerCase()).test(a.professional.name.toLowerCase())&&(b[a.professional.name]=!0)})});for(var d in b)b.hasOwnProperty(d)&&c.push(d);return c}l.filter(void 0,void 0,l.professionalFiltered)},l.selectedAppointmentInAppointments=function(a){for(var b=0;b<a.length;b++)if(l.selectedAppointment===a[b])return!0;return!1},l.changeStep=function(a,b){return 3===a&&l.selectedAppointment?(b||(l.state.step=3),!0):2===a&&l.appointments&&l.appointments.length?(b||null!=l.selectedAppointment&&(l.state.step=2),!0):1===a?(b||(l.state.step=1),!0):!1},l.logout=function(){h.logout()},l["goto"]=function(a){g.setTimeout(function(){$("html, body").animate({scrollTop:$("[id='"+a+"']").offset().top},1500)},500)},l.editPatientInformation=function(a){j.open({templateUrl:"modal/edit-contactabilidad.view.html",controller:"editarContactabilidadModalController",controllerAs:"ecmc",windowClass:"agenda-modal",resolve:{autoFocus:function(){return a}}})};var m;return l._loadSpecialties=function(a){"undefined"==typeof a&&(a=m),l.specialties=[],a.forEach(function(a){-1===l.specialties.indexOf(a.specialty)&&l.specialties.push(a.specialty)})},l._loadTypeAttentions=function(a){"undefined"==typeof a&&(a=m),l.typesAttentions=[],a.forEach(function(a){-1===l.typesAttentions.indexOf(a.typeAttention)&&l.typesAttentions.push(a.typeAttention)})},l._specialtyOnChange=function(){if(l.typeAttentionFiltered=null,l.specialtyFiltered){var a=[];m.forEach(function(b){b.specialty===l.specialtyFiltered&&a.push(b)}),l._loadTypeAttentions(a)}else l._loadTypeAttentions([])},l._cacheProfessional=function(a){m=[],l.appointments.forEach(function(b){b.professional.name===a&&m.push(b)}),l._loadSpecialties()},l._verAgenda=function(){l.filteredAppointments=[],m.forEach(function(a){a.specialty===l.specialtyFiltered&&a.typeAttention===l.typeAttentionFiltered&&l.filteredAppointments.push(a)}),l.filteredAppointments=[a("orderBy")(l.filteredAppointments,"date")],l.state.appointmentsStart=l.filteredAppointments[0][0].date,l.viewDiary(l.filteredAppointments)},l._getProfessionals=function(a){if(a.hasOwnProperty(l.typeAttentionFiltered))return a[l.typeAttentionFiltered];if(angular.isArray(l.filteredAppointmentsMobile)){var b={};return b[l.filteredAppointmentsMobile[0].professional.name]=l.filteredAppointmentsMobile,b}return angular.isObject(l.filteredAppointmentsMobile)?l.filteredAppointmentsMobile:!1},l.filter(),l}angular.module("sdx.agenda.agendamiento").controller("AgendamientoController",a),a.$inject=["$filter","toastr","toastrNoDismiss","$rootScope","HealthProblemsConst","AppointmentsService","$window","PatientSession","appointments","$modal"]}(),function(){"use strict";function a(a,b,c,d,e,f,g){function h(){j.appointments=d("PasadoFuturo")(j.futureAppointments,j.old,j.now)}function i(){return j.futureAppointments=[],j.loading=!0,e.loadFutures(a).then(function(a){j.futureAppointments=a,h()},function(a){g.warning("Ha ocurrido un error al cargar las citas agendadas","Citas")})["finally"](function(){j.loading=!1})}var j=this;j.futureAppointments=c,j.patient=a,j.now=new Date,j.old=!1,j.order="+date",j.appointments=[],j.setOld=function(a){j.old=a,h()},j.cancelAppointment=function(a){var c=b.open({templateUrl:"../scripts/globals/modals/editAppointment/editAppointment.modal.html",controller:"modalEditAppointment",controllerAs:"eamc",windowClass:"agenda-modal",resolve:{appointment:function(){return a},appointments:function(){return j.futureAppointments}}});c.result.then(function(){j.loading=!0,i()})},j.voucher=function(a){j.appointmentActive=a;b.open({templateUrl:"modal/voucher.view.html",controller:"voucherModalController",controllerAs:"vmc",windowClass:"agenda-modal",resolve:{appointment:function(){return j.appointmentActive},patient:function(){return j.patient}}})},j.logout=function(){f.logout()}}angular.module("sdx.agenda.agendamiento").controller("anularCitaController",a),a.$inject=["patient","$modal","futureAppointments","$filter","AppointmentsService","PatientSession","toastr"]}(),function(){"use strict";function a(a,b){var c=this;return c.logout=function(){return b.logout()},c}angular.module("sdx.agenda.agendamiento").controller("NoCitasController",a),a.$inject=["$window","PatientSession"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i){var j=this;return j.patient=d.patient(),j.email=angular.copy(j.patient.email),j.print=function(){b.print()},j.loading=!1,j.sendByEmail=function(){if(j.patient.email){j.loading=!0;var b=e.info("Enviando comprobante","Comprobante",g);return h.sendEmail(a.id,j.patient).then(function(a){e.success("Comprobante enviado correctamente.","Comprobante")},function(a){j.loading=!1,e.warning("Ha ocurrido un error al enviar el correo electrónico.","Comprobante")})["finally"](function(){e.clear(b)})}e.warning("Por favor registra un correo electrónico","Comprobante")},j.save=function(){if(j.email!==j.patient.email){j.loading=!0;var a=e.info("Actualizando correo elecónico","Correo electrónico",g);return i.updateEmail(j.patient,j.email).then(function(a){e.success("Datos modificados correctamente.","Correo electrónico"),c.close()},function(a){j.loading=!1,e.warning("Ha ocurrido un error al editar los datos de contacto!","Correo electrónico")})["finally"](function(){e.clear(a)})}},j}angular.module("sdx.agenda.agendamiento").controller("voucherModalController",a),a.$inject=["appointment","$window","$modalInstance","PatientSession","toastr","RestEndpoints","toastrNoDismiss","AppointmentsService","PatientService"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j){var k=this;return k.loading=!1,k.patient=f.patient(),k.contactData=j.getContactDataCopy(k.patient),k.autoFocus=e,k.countryCode="56",k.save=function(){k.loading=!0;var b=c.info("Actualizando datos","Contactabilidad",g);j.updateContactData(k.patient,k.contactData.telephone,k.contactData.cellphone,k.contactData.email).then(function(){c.success("Datos actualizados con exito","Contactabilidad"),a.close()},function(a){c.error(a,"Contactabilidad")})["finally"](function(){c.clear(b)})},k}angular.module("sdx.agenda.agendamiento").controller("editarContactabilidadModalController",a),a.$inject=["$modalInstance","$timeout","toastr","RestEndpoints","autoFocus","PatientSession","toastrNoDismiss","$q","PhoneTypes","PatientService"]}(),function(){"use strict";function a(){return function(a,b,c){var d=[];if(!a||!angular.isArray(a))return a;for(var e=0;e<a.length;e++)(b&&a[e].date<c||!b&&a[e].date>=c)&&d.push(a[e]);return d}}angular.module("sdx.agenda.agendamiento").filter("PasadoFuturo",a),a.$inject=[]}();