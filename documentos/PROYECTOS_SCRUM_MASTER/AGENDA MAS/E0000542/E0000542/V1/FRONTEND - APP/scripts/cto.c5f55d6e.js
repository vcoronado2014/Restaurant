!function(){"use strict";angular.module("sdx.agenda.globals",["sdx.envConfig","mm.foundation"])}(),function(){"use strict";angular.module("sdx.agenda.globals").constant("PhoneTypes",{telephone:{label:"TEL1_FICHA_FAMILIAR",typeId:1},cellphone:{label:"MOVIL_FICHA_FAMILIAR",typeId:4}}).constant("HealthProblemsConst",{Alergias:"medicina general",Cefalea:"neuro","Colon Irritable":"medicina general",Diabetes:"medicina general",Diarrea:"medicina general","Hipertensión Arterial":"cardio",Infertilidad:"gine","Obesidad y Nutrición":"medicina general","Patología Mamaría":"gine"})}(),function(){"use strict";function a(a,b){return{login:a+"/Login/",buscarPaciente:a+"/BuscarPaciente/",obtenerDisponibilidad:a+"/ObtenerDisponibilidad/",notificarCitaNueva:a+"/NotificarCitaNueva/",editarInformacionPaciente:a+"/EditarInformacionPaciente/",crearTelefonoPaciente:a+"/CrearTelefonoPaciente/",anularCita:a+"/AnularCita/",obtenerCitasFuturas:a+"/ObtenerCitasFuturas/",buscarProfesional:a+"/BuscarProfesional/",obtenerCitasAgendadas:a+"/ObtenerCitasAgendadas/",rechazarCita:a+"/RechazarCita",crearCaso:a+"/CrearCaso",agendarCita:a+"/AgendarCita",cerrarCaso:a+"/CerrarCaso",enviarCorreo:a+"/NotificarCita",obtenerEstablecimiento:a+"/ObtenerEstablecimiento",obtenerCentroContacto:a+"/ObtenerCentroContacto",crearCentroContacto:a+"/CrearCentroContacto",actualizarCentroContacto:a+"/ActualizarCentroContacto",obtenerContratos:a+"/ObtenerContratos",actualizarContrato:a+"/ActualizarContrato",obtenerListaTrabajo:a+"/ObtenerListaTrabajo",crearTelefonista:a+"/CrearTelefonista",actualizarTelefonista:a+"/ActualizarTelefonista",obtenerAlcanceCentroContacto:a+"/ObtenerAlcanceCentroContacto",obtenerCitasPorFiltro:a+"/ObtenerCitasPorFiltro",notificarCitaReagendada:a+"/NotificarCitaReagendada",jasperServer:b}}angular.module("sdx.agenda.globals").factory("RestEndpoints",a),a.$inject=["AGENDA_API_BASE","REPORTS_BASE"]}(),function(){"use strict";function a(){this.list=[],this.listAux=[]}function b(a,b){this.filter=function(c,d){var e,f=(d.date||"").trim();f?(e=[],f=f.split(/\//g),c.forEach(function(a){parseInt(f[2])===new Date(a.date).getFullYear()&&parseInt(f[1])-1===new Date(a.date).getMonth()&&parseInt(f[0])===new Date(a.date).getDate()&&e.push(a)})):e=c,b.listAux=a("filterObj")(c,void 0,"healthCareCenter",d.healthCareCenter,"specialty",d.specialty,"professional",d.professional),b.list=a("filterObj")(e,void 0,"healthCareCenter",d.healthCareCenter,"specialty",d.specialty,"professional",d.professional);var g=[],h={};b.list.forEach(function(a){h[a.specialty]||(h[a.specialty]={}),h[a.specialty][a.professional]||(h[a.specialty][a.professional]={}),h[a.specialty][a.professional][a.typeAttention]||(h[a.specialty][a.professional][a.typeAttention]=[]),h[a.specialty][a.professional][a.typeAttention].push(a)});for(var i in h)if(h.hasOwnProperty(i))for(var j in h[i])if(h[i].hasOwnProperty(j))for(var k in h[i][j])h[i][j].hasOwnProperty(k)&&g.push(h[i][j][k]);return g}}angular.module("sdx.agenda.globals").service("appointmentsDrive",a).service("aDriver",b),a.$inject=[],b.$inject=["$filter","appointmentsDrive"]}(),function(){"use strict";function a(){return function(a,b){if(!a)return a;var c={Monday:"Lunes",Tuesday:"Martes",Wednesday:"Miércoles",Thursday:"Jueves",Friday:"Viernes",Saturday:"Sábado",Sunday:"Domingo"};if(b){for(var d in c)c.hasOwnProperty(d)&&(a=a.replace(d,c[d]));return a}return c[a]||a}}angular.module("sdx.agenda.globals").filter("NameOfDayFilter",a),a.$inject=[]}(),function(){function a(){return function(a,c){if(c=c?c:"format","format"===c){var d=b(a),e=d[0],f=d[1];if(!e||!f)return"";for(var g="";e.length>3;)g="."+e.substr(e.length-3)+g,e=e.substring(0,e.length-3);return(e+g+"-"+f).toLowerCase()}if("validate"===c){for(var h=a.replace(/\./g,"").split(/\-/),i=parseInt(h[0]),j=0,k=1;i;i=Math.floor(i/10))k=(k+i%10*(9-j++%6))%11;var l=k?k-1:"k";return String(l)===h[1]}}}function b(a){var b=(a||"").replace(/[\.\-]/g,"");if(0===b.length)return[null,null];if(1===b.length)return[b,null];var c=b.charAt(b.length-1),d=b.substring(0,b.length-1);return[d,c]}angular.module("sdx.agenda.globals").filter("RunFormatFilter",a),a.$inject=[]}(),function(){"use strict";function a(){return function(a,b){if("string"==typeof b&&"clear"===b)return a.replace(/^\+56[2|9]/,"");if(b)return/^\+56[2|9][0-9]{8}$/.test(a);if(a){a=a.replace(/^\+56[0-9]/,"");/^2/.test(a)?"2":"9";return"+56 "+a}return""}}angular.module("sdx.agenda.globals").filter("TelephoneFilter",a),a.$inject=[]}(),function(){"use strict";function a(){return function(a,b,c,d,e,f,g,h,i,j){var k=[],l={};return a&&a.forEach(function(a){if(c&&d&&a[c]!==d)return!1;if(e&&f&&a[e]!==f)return!1;if(g&&h&&a[g]!==h)return!1;if(i&&j&&a[i]!==j)return!1;if(b){var m=a[b];l[m]||(l[m]=!0,k.push(m))}else k.push(a)}),k}}angular.module("sdx.agenda.globals").filter("filterObj",a),a.$inject=[]}(),function(){"use strict";function a(){return{template:'<div class="sk-fading-circle"><div class="sk-circle1 sk-circle"></div><div class="sk-circle2 sk-circle"></div><div class="sk-circle3 sk-circle"></div><div class="sk-circle4 sk-circle"></div><div class="sk-circle5 sk-circle"></div><div class="sk-circle6 sk-circle"></div><div class="sk-circle7 sk-circle"></div><div class="sk-circle8 sk-circle"></div><div class="sk-circle9 sk-circle"></div><div class="sk-circle10 sk-circle"></div><div class="sk-circle11 sk-circle"></div><div class="sk-circle12 sk-circle"></div></div>',link:function(a,b,c){$(b).find(".sk-circle").addClass(c.loadIcon)}}}angular.module("sdx.agenda.globals").directive("loadIcon",a),a.$inject=[]}(),function(){"use strict";function a(){return{link:function(a,b,c){$(b).click(function(){c.cModal&&$(this).parents(".reveal-modal").removeClass("tiny").removeClass("small").removeClass("medium").removeClass("large").removeClass("largee").removeClass("xlarge").removeClass("full").removeClass("mediumm").addClass(c.cModal)})}}}angular.module("sdx.agenda.globals").directive("cModal",a),a.$inject=[]}(),function(){"use strict";function a(){return{link:function(a,b,c){var d=c.itOnly;d&&($(b).attr("it-only",""),d=new RegExp(d),$(b).keypress(function(a){var b=String.fromCharCode(document.all?a.keyCode:a.which);a.key||d.test(b)?d.test(b)||1!==a.key.length||/^[cvx]$/.test(a.key)||a.preventDefault():a.preventDefault()}))}}}function b(){return{link:function(a,b,c){function d(){$(this).val()?c.itPatternerrormessage||this.setCustomValidity(""):this.setCustomValidity(e)}var e=c.itEmptymessage;e&&($(b).attr("it-emptyMessage",""),$(b).change(d),$(b).keypress(d),$(b).keyup(d),$(b).val()||b[0].setCustomValidity(e))}}}function c(){return{scope:{reg:"=itPattern"},link:function(a,b,c){function d(){var a="function"==typeof e?e():new RegExp(e),b=$(this);""!==b.val()?"object"==typeof a&&a.test(b.val())?this.setCustomValidity(""):"boolean"==typeof a&&a?this.setCustomValidity(""):this.setCustomValidity(f):""!==b.val()||c.itEmptymessage?this.setCustomValidity(""):this.setCustomValidity(f)}var e=a.reg||"",f=c.itPatternerrormessage;e&&f&&($(b).attr("it-pattern",""),$(b).attr("it-patternerrormessage",""),$(b).change(d),$(b).keypress(d),$(b).keyup(d))}}}angular.module("sdx.agenda.globals").directive("itOnly",a).directive("itEmptymessage",b).directive("itPattern",c),a.$inject=[],b.$inject=[],c.$inject=[]}(),function(){"use strict";function a(a,c,d){function e(b,d,e){b.asc.element=d;var f=b.asc.appointments;$(d).children("div").eq(0).attr("data-date",c("date")(b.asc.startAppointmentsDay,"dd/MM/yyyy")),$(d).children("div").eq(0).fdatepicker({language:"es",weekStart:1,format:"dd/mm/yyyy",onRender:function(a){for(var b=0;b<f.length;b++){var c=f[b].date,d=new Date(c);if(d.setDate(d.getDate()-1),a.getFullYear()===d.getFullYear()&&a.getMonth()===d.getMonth()&&a.getDate()===d.getDate())return""}return"disabled"}}).on("changeDate",function(c){b.asc.startAppointmentsDay=new Date(c.date.setDate(c.date.getDate()+1)),b.asc.organizeAppointments(),a.$apply()})}return{link:e,restrict:"EA",scope:{appointments:"=appointments",selectedAppointment:"=selectedAppointment"},templateUrl:d+"/scripts/globals/directives/appointments-selection/appointments-selection.html",controller:b,controllerAs:"asc",bindToController:!0}}function b(a,b,c){function d(){var a,b=[],c=new Date(g.startAppointmentsDay);for(a=0;7>a;a++)b.push(new Date(c)),c.setDate(c.getDate()+1);var d=[],e={},f={},h=new Date(g.startAppointmentsDay);h.setHours(0),h.setMinutes(0),h.setSeconds(0);var i=new Date(g.startAppointmentsDay);i.setDate(i.getDate()+6),i.setHours(23),i.setMinutes(59),i.setSeconds(59),g.appointments.forEach(function(a){if(a.date<h||a.date>i)return!1;var b=a.date.getHours();b=(10>b?"0":"")+b;var c=a.date.getMinutes();c=(10>c?"0":"")+c,f[b+":"+c]||(f[b+":"+c]=[!1,!1,!1,!1,!1,!1,!1])});var j=Object.keys(f),k=j.length;for(j.sort(),a=0;k>a;a++){var l=j[a];e[l]=f[l]}g.appointments.forEach(function(a){var c=a.date.getHours();c=(10>c?"0":"")+c;var f=a.date.getMinutes();f=(10>f?"0":"")+f,b.forEach(function(b,g){b.getFullYear()===a.date.getFullYear()&&b.getMonth()===a.date.getMonth()&&b.getDate()===a.date.getDate()&&(e[c+":"+f][g]=a,d.push(a))})}),g.orderedAppointmentsDays=b,g.orderedAppointments=e,g.filteredAppointments=d}function e(){var a=new Date(g.startAppointmentsDay);a.setDate(a.getDate()-7),g.startAppointmentsDay=a,$(g.element).children("div").eq(0).fdatepicker("update",c("date")(a,"dd/MM/yyyy")),g.organizeAppointments()}function f(){var a=new Date(g.startAppointmentsDay);a.setDate(a.getDate()+7),g.startAppointmentsDay=a,$(g.element).children("div").eq(0).fdatepicker("update",c("date")(a,"dd/MM/yyyy")),g.organizeAppointments()}var g=this;g.organizeAppointments=d,g.prevWeek=e,g.nextWeek=f,g.appointments=c("orderBy")(g.appointments,"date"),g.startAppointmentsDay=g.appointments[0]?g.appointments[0].date:new Date,d(),g.setSelectedAppointment=function(a){g.selectedAppointment=a}}angular.module("sdx.agenda.globals").directive("appointmentsSelection",a),a.$inject=["$rootScope","$filter","BASE_PATH"],b.$inject=["$scope","$parse","$filter"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){var i=this;i.BASE_PATH=f,i.appointment=d,i.appointments=[],i.appointmentsFiltered=[],i.appointmentsLoaded=!1,i.error={},i.setData=function(){i.email=angular.copy(d.patient.email),i.telephone=angular.copy(d.patient.telephone),i.cellphone=angular.copy(d.patient.cellphone),i.areaCode=angular.copy(d.patient.telephoneAreaCode)},i.setData(),i.organizeAppointmentsMobile=function(){var a=i.appointments,b={},c=[],d=new Date;a.forEach(function(a){if(a.date>d){var c=a.date.getFullYear()+a.date.getMonth()+a.date.getDate();b[c]||(b[c]=[]),b[c].push(a)}});for(var e in b)b.hasOwnProperty(e)&&c.push(b[e]);i.appointmentsHoursMobile=c},i.selectedAppointmentInAppointments=function(a){for(var b=0;b<a.length;b++)if(i.appointment===a[b])return!0;return!1},i.loadAppointments=function(){return i.appointmentsLoaded?!1:(i.loading=!0,g.availablesForReschedule(d).then(function(a){i.loading=!1,i.appointments=a,i.appointmentsLoaded=!0,i.appointmentsFiltered=e.filter(i.appointments,{}),i.organizeAppointmentsMobile()},function(a){i.loading=!1,b.warning("Ha ocurrido un error al cargar las citas disponibles","Atención")}))};var j=function(a){return i.appointment.patient.email?g.sendEmail(a,i.appointment.patient).then(function(){b.success("Comprobante enviado correctamente.","Información")},function(a){b.warning(a,"Atención")}):void b.warning("No tienes un correo electrónico registrado.","Datos de contacto")};return i.confirm=function(){i.loading=!0;var d=b.info("Actualizando datos","Confirmar",c);return g.confirm(i.appointment,"confirm",void 0,i.appointment.idQuota||-1).then(function(){return b.success("La cita fue confirmada correctamente.","Confirmar"),a.close()},function(){i.loading=!1,b.warning("Ha ocurrido un error al confirmar la cita","Confirmar")})["finally"](function(){b.clear(d)})},i.cancel=function(){i.loading=!0;var e=b.info("Actualizando datos","Anular cita",c);return g.cancel(d,"cancel").then(function(){b.success("La cita fue anulada correctamente.","Anular cita"),a.close()},function(){i.loading=!1,b.warning("Ha ocurrido un error al anular la cita","Anular cita")})["finally"](function(){b.clear(e)})},i.reschedule=function(e,f){if(!e)return b.warning("Debes elegir una cita para poder reagendar.","Atención"),!1;i.loading=!0;var h=b.info("Actualizando datos","Reagendar",c);return g.reschedule(d,"reschedule",e).then(function(c){b.success("La cita se reagendó correctamente.","Reagendar"),f&&j(c.IdentificadorCita),a.close()},function(a){i.loading=!1,b.warning("Ha ocurrido un error al anular la cita","Reagendar")})["finally"](function(){b.clear(h)})},i.changeDataPatient=function(a,e,f){i.loading=!0;var g=b.info("Actualizando datos","Datos de contacto",c);h.updateContactData(d.patient,e,f,a).then(function(){i.setData(),b.success("Datos actualizados con éxito","Datos de contacto")},function(a){b.error("Ha ocurrido algo inesperado","Datos de contacto")})["finally"](function(){b.clear(g),i.loading=!1})},i}angular.module("sdx.agenda.modals",["sdx.agenda.globals","sdx.agenda.appointments"]).controller("modalEditAppointment",a),a.$inject=["$modalInstance","toastr","toastrNoDismiss","appointment","aDriver","BASE_PATH","AppointmentsService","PatientService"]}(),function(){"use strict";angular.module("sdx.agenda.patient",["sdx.agenda.globals"])}(),function(){"use strict";function a(a,b,c,d){var e=this;e.newPhone=function(e,f,g){return a({method:"POST",url:b.crearTelefonoPaciente,headers:{"Content-Type":"text/json"},data:JSON.stringify({Telefono:e,IdPaciente:g.id,EtiquetaTelefono:d[f].label,TipoTelefono:d[f].typeId,CodArea:"",CodPais:"56"})}).then(function(a){var b=a.data;0===parseInt(b.Estatus)?g[f]=e:c.reject()})},e.editPhoneEmail=function(e,f,g,h){return a({method:"POST",url:b.editarInformacionPaciente,headers:{"Content-Type":"text/json"},data:JSON.stringify({Email:g||"",EtiquetaTelefono:d[f].label,IdPaciente:h.id,Telefono:e||"",CodigoArea:"0"})}).then(function(a){var b=a.data;return 0===parseInt(b.Estatus)?(h.email=g,void(h[f]=e)):void c.reject()})};var f={getContactDataCopy:function(a){return{email:a.email,telephone:a.telephone,cellphone:a.cellphone,areaCode:String(a.telephoneAreaCode)||"2",countryCode:String(a.telephoneCountryCode)||"56"}},updateContactData:function(a,b,d,f){a.telephone=a.telephone.toString(),b=b.toString();var g=[];return a.telephone!==b&&(a.telephone?g.push(e.editPhoneEmail(b,"telephone",f,a)):g.push(e.newPhone(b,"telephone",a))),a.cellphone!==d&&(a.cellphone?g.push(e.editPhoneEmail(d,"cellphone",f,a)):g.push(e.newPhone(b,"cellphone",a))),g.length||a.email.toString()===f.toString()||g.push(e.editPhoneEmail(b,"telephone",f,a)),c.all(g)},updateEmail:function(a,b){return e.editPhoneEmail(a.telephone,"telephone",b,a)},getFromApi:function(a){var b={};return angular.isObject(a)?(b.id=parseInt(a.Id_Paciente),b.name=a.Nombres+" "+a.Ap_Paterno+" "+a.Ap_Materno,b.run=a.Rut,b.healthCareCenter={},b.healthCareCenter.id=parseInt(a.Id_nodo),b.healthCareCenter.name=a.Nodo,b.section=a.section,b.email=a.Email,b.telephone=a.Tel_Contacto,b.cellphone=a.Movil_Contacto,b.telephoneAreaCode=a.Tel_Contacto_Codigo_Area,b.telephoneCountryCode=a.Tel_Contacto_Codigo_Pais,b):b},isValidData:function(a,b){return b&&a&&b.FechaNacimiento&&a&&parseInt(a)!==parseInt(b.Id_Paciente)}};return f}angular.module("sdx.agenda.patient").factory("PatientService",a),a.$inject=["$http","RestEndpoints","$q","PhoneTypes"]}(),function(){"use strict";angular.module("sdx.agenda.appointments",["sdx.agenda.globals"])}(),function(){"use strict";function a(a,b,c,d,e){var f=this;f.appointments=[],f.appointmentsLoaded=!1,f.HTTP_CONFIG={headers:{"Content-Type":"text/json"}},f.anularCita=function(d){return a.post(c.anularCita,{IdentificadorCitaRechazada:d.IdentificadorCita},f.HTTP_CONFIG)["catch"](function(){return b.reject({type:"error",msg:"Ha ocurrido un error al agendar la cita"})})};var g={newResource:function(){return{id:null,date:null,typeAttention:null,specialty:null,professional:{id:null,name:null}}},load:function(e){return a.post(c.obtenerDisponibilidad,{FechaInicio:d("date")(new Date,"yyyyMMdd"),IdsNodo:e.healthCareCenter.id,IdentificadorPaciente:e.id},f.HTTP_CONFIG).then(function(a){return a.data.hasOwnProperty("TypeCupo")?(angular.isArray(a.data.TypeCupo)||(a.data.TypeCupo?a.data.TypeCupo=[a.data.TypeCupo]:a.data.TypeCupo=[]),a.data.TypeCupo.forEach(function(a){var b=parseInt(a.Fecha.substring(0,4)),c=parseInt(a.Fecha.substring(4,6))-1,d=parseInt(a.Fecha.substring(6,8)),e=parseInt(a.Hora.split(/\:/g)[1]),g=parseInt(a.Hora.split(/\:/g)[0]);f.appointments.push({id:parseInt(a.IdCupo),professional:{name:a.NombreMedico+" "+a.ApPaternoMedico,id:parseInt(a.IdMedico)},specialty:a.Especialidad,typeAttention:a.TipoAtencion,date:new Date(b,c,d,g,e),healthCareCenter:{id:a.IdNodo}})}),f.appointmentsLoaded=!0,f.appointments):b.reject()})},getList:function(a,c){return f.appointmentsLoaded&&!c?b.resolve(f.appointments):g.load(a).then(function(){return f.appointments})},getListFuture:function(a){return f.appointmentsFutureLoaded?f.futureAppointments:g.loadFutures(a).then(function(){return f.futureAppointments})},make:function(e,g,h){return a.post(c.notificarCitaNueva,{FechaEnteraCupo:d("date")(new Date(e.date),"yyyyMMdd"),IdCupo:e.id,IdPaciente:g,Fecha:d("date")(new Date(e.date),"yyyy-MM-dd HH:mm"),IdNodo:e.healthCareCenter.id,Comentario:e.healthCareCenter.id},f.HTTP_CONFIG).then(function(a){return a.data&&a.data.RespuestaBase&&a.data.RespuestaBase.hasOwnProperty("Estatus")?0!==parseInt(a.data.RespuestaBase.Estatus)?b.reject({type:"warning",msg:a.data.RespuestaBase.Descripcion}):{IdentificadorCita:a.data.IdentificadorCita,IdCaso:a.data.IdCaso,IdCupo:a.data.IdCupo}:b.reject({type:"error",msg:"Ha ocurrido un error en el servidor. Por favor intente más tarde"})})},loadFutures:function(d){return a({method:"POST",url:c.obtenerListaTrabajo,headers:{"Content-Type":"text/json"},data:JSON.stringify({IdPaciente:d.id})}).then(function(a){var c=a.data;if(c.RespuestaBase&&0===c.RespuestaBase.Estatus){var e=[],g={};c.Citas.forEach(function(a){if(!a.FechaCita)return!1;if(parseInt(a.IdPaciente)!==parseInt(d.id))return!1;var b=parseInt(a.FechaCita.substring(0,4)),c=parseInt(a.FechaCita.substring(4,6))-1,e=parseInt(a.FechaCita.substring(6,8)),f=parseInt(a.HoraCita.split(/\:/g)[1]),h=parseInt(a.HoraCita.split(/\:/g)[0]);g[a.IdCita]={id:a.IdCita,idQuota:a.IdCupo,status:a.EstadoSonia,idCase:a.IdCaso,date:new Date(b,c,e,h,f),patient:{id:a.IdPaciente,run:a.RutPaciente,name:a.NombrePaciente,cellphone:a.MOVIL_CONTACTO||a.MOVIL_FICHA_FAMILIAR,tagCelhone:a.MOVIL_CONTACTO?"MOVIL_FICHA_FAMILIAR":a.MOVIL_FICHA_FAMILIAR?"MOVIL_FICHA_FAMILIAR":"",telephone:a.TEL1_CONTACTO||a.TEL1_FICHA_FAMILIAR,tagTelephone:a.TEL1_CONTACTO?"TEL1_FICHA_FAMILIAR":a.TEL1_FICHA_FAMILIAR?"TEL_FICHA_FAMILIAR":"",email:a.Email,telephoneAreaCode:a.TEL1_CONTACTO_CODIGO_AREA,telephoneCountryCode:a.TEL1_CONTACTO_CODIGO_PAIS},healthCareCenter:{id:a.IdNodo,name:a.Nodo},specialty:{id:a.IdEspecialidad,name:a.Especialidad},typeAttention:{id:0,name:a.TipoAtencion},professional:{id:0,name:a.Profesional}}});for(var h in g)g.hasOwnProperty(h)&&e.push(g[h]);return f.futureAppointments=e,e}return b.reject("Ha ocurrido un error al cargar las citas agendadas")})},availablesForReschedule:function(e){return a({method:"POST",url:c.obtenerDisponibilidad,headers:{"Content-Type":"text/json"},data:JSON.stringify({FechaInicio:d("date")(new Date,"yyyyMMdd"),IdsNodo:e.healthCareCenter.id,IdentificadorPaciente:e.patient.id})}).then(function(a){var c=a.data,d=[];return c?(angular.isArray(c.TypeCupo)||(c.TypeCupo?c.TypeCupo=[c.TypeCupo]:c.TypeCupo=[]),c.TypeCupo.forEach(function(a){if(a.Especialidad.toLowerCase()!==e.specialty.name.toLowerCase()||a.TipoAtencion.toLowerCase()!==e.typeAttention.name.toLowerCase())return!1;var b=parseInt(a.Fecha.substring(0,4)),c=parseInt(a.Fecha.substring(4,6))-1,f=parseInt(a.Fecha.substring(6,8)),g=parseInt(a.Hora.split(/\:/g)[1]),h=parseInt(a.Hora.split(/\:/g)[0]);d.push({id:parseInt(a.IdCupo),healthCareCenter:parseInt(a.IdNodo),professional:a.NombreMedico+" "+a.ApPaternoMedico,specialty:a.Especialidad,typeAttention:a.TipoAtencion,date:new Date(b,c,f,h,g)})}),d):b.reject("Ha ocurrido un error al cargar las citas disponibles")})},sendEmail:function(d,e){return a({method:"POST",url:c.enviarCorreo,headers:{"Content-Type":"text/json"},data:JSON.stringify({idCita:d,idPaciente:e.id,rutPaciente:e.run})}).then(function(a){try{var c=a.data;return 0===c.RespuestaBase.Estatus?!0:b.reject("Ha ocurrido algo inesperado")}catch(d){return b.reject("Ha ocurrido algo inesperado")}},function(a){return b.reject("Ha ocurrido un error al enviar el correo electrónico.")})},confirm:function(d,g,h,i){var j;switch(g){case"confirm":j=e.Confirmada;break;case"cancel":j=e.Cancelada;break;default:j=e.Reagendada}return a.post(c.agendarCita,{IdCaso:d.idCase,IdCita:h||d.id,IdCupo:i,IdEstadoCita:j,Comentario:d.healthCareCenter.id},f.HTTP_CONFIG).then(function(a){var c=a.data;0===c.RespuestaBase.Estatus&&b.resolve()})},cancel:function(d,e){return a.post(c.anularCita,{IdentificadorCitaRechazada:d.id},f.HTTP_CONFIG).then(function(a){var c=a.data;0===c.Estatus?b.resolve():b.reject("Ha ocurrido un error al anular la cita")})},reschedule:function(e,g,h){return a.post(c.notificarCitaReagendada,{FechaEnteraCupo:d("date")(new Date(h.date),"yyyyMMdd"),IdCupo:h.id,IdPaciente:e.patient.id,Fecha:d("date")(new Date(h.date),"yyyy-MM-dd HH:mm"),IdCitaEliminada:e.id,IdNodo:e.healthCareCenter.id},f.HTTP_CONFIG).then(function(a){var c=a.data;0!==parseInt(c.Estatus)?b.reject("Ha ocurrido un error al anular la cita"):b.resolve()})}};return g}angular.module("sdx.agenda.appointments").constant("EstadoCitaConst",{Agendada:1,Confirmada:2,Cancelada:3,Reagendada:4}).factory("AppointmentsService",a),a.$inject=["$http","$q","RestEndpoints","$filter","EstadoCitaConst"]}(),function(){"use strict";function a(a,b,c,d,e,f){c.debugInfoEnabled(e),d.debugEnabled(e),a.state("login",{url:"/login",views:{main:{templateUrl:"partials/login.html",controller:"LoginController as lc"}}}).state("operador",{url:"/operador/:page",login:!0,views:{main:{templateUrl:"partials/operador/main.html",controller:"OperadorController as oc"},"header@operador":{templateUrl:"partials/operador/header.html"},"atencion@operador":{templateUrl:"partials/operador/atencion/main.html",controller:"AtencionController as vm"},"busqueda@operador":{templateUrl:"partials/operador/atencion/busqueda.html"},"citasAgendadas@operador":{templateUrl:"partials/operador/atencion/citasAgendadas.html"},"medicosDisponibles@operador":{templateUrl:"partials/operador/atencion/medicosDisponibles.html"},"lista@operador":{templateUrl:"partials/operador/lista/main.html",controller:"ListaTrabajoController as vm"}}}).state("administrador",{url:"/administrador/:page",login:!0,resolve:{centros:["CentrosContactoService","toastr","toastrNoDismiss",function(a,b,c){var d=b.info("cargando datos","Centros",c);return a.getList()["catch"](function(a){b.error(a,"Centros")})["finally"](function(){b.clear(d)})}]},views:{main:{templateUrl:"partials/administrador/main.html",controller:"OperadorController as oc"},"header@administrador":{templateUrl:"partials/administrador/header.html"},"usuarios@administrador":{templateUrl:"partials/administrador/usuarios/main.html",controller:"ContratoController as vm"},"centroDeContacto@administrador":{templateUrl:"partials/administrador/centrodecontacto/main.html",controller:"CentroDeContactoController as vm"},"reportes@administrador":{templateUrl:"partials/administrador/reportes/main.html"}}}),b.otherwise("/login"),angular.extend(f,{autoDismiss:!0,closeButton:!0,positionClass:"toast-top-right",progressBar:!0,timeOut:7e3})}function b(a,b,c,d,e){if(localStorage.user)try{d.init(angular.fromJson(c.decode(localStorage.user)))}catch(f){}a.$on("$stateChangeStart",function(a,c,f){c.login&&!d.id?(b.transitionTo("login"),a.preventDefault()):"login"===c.name&&d.id&&"operador"===d.type?(b.transitionTo("operador",{page:"atencion"}),a.preventDefault()):"login"===c.name&&d.id&&"administrador"===d.type&&(b.transitionTo("administrador",{page:"usuarios"}),a.preventDefault()),"operador"===c.name&&"atencion"!==f.page&&"login"!==c.name&&d.attention.idPatient&&(e.warning("No puedes cambiar de sección sin terminar la atención.","¡Alerta!"),a.preventDefault())})}angular.module("sdx.agenda.contacto",["ui.router","mm.foundation","base64","toastr","sdx.envConfig","sdx.agenda.globals","sdx.agenda.patient","sdx.agenda.modals"]).config(a).run(b).constant("toastrNoDismiss",{autoDismiss:!1,closeButton:!1,progressBar:!1,timeOut:0,tapToDismiss:!1}),a.$inject=["$stateProvider","$urlRouterProvider","$compileProvider","$logProvider","DEBUG","toastrConfig"],b.$inject=["$rootScope","$state","$base64","user","toastr"]}(),function(){"use strict";function a(a,b,c,d,e){var f=this;f.user="",f.password="",f.error="",f.userdata=null,f.loading=!1,f._submit=function(a){f.loading=!0,c({method:"POST",url:d.login,headers:{"Content-Type":"text/json"},data:JSON.stringify({Login:f.user,Pass:f.password})}).then(function(a){var c=a.data;f.error="",c.IdTelefonista&&"0"!==c.IdTelefonista?parseInt(c.EsSupervisor)||parseInt(c.EsAdministrador)?(b.init("administrador"),f.userdata=b,f.userdata.id=parseInt(c.IdTelefonista),f.userdata.healthCareCenters=[],c.Establecimiento&&(angular.isArray(c.Establecimiento)?f.userdata.healthCareCenters=c.Establecimiento.map(function(a){return{id:parseInt(a.IdNodo),idEstablecimiento:parseInt(a.Id_Establecimiento),name:a.NombreEstablecimiento}}):f.userdata.healthCareCenters=[c.Establecimiento]),f.userdata.contactCenter={},c.Centro&&(f.userdata.contactCenter.id=c.Centro.Id_Centro),f.userdata.username=c.Nombre_1+" "+c.ApePaterno,f.userdata.supervisor=parseInt(c.EsSupervisor)?!0:!1,f.userdata.administrador=parseInt(c.EsAdministrador)?!0:!1,f.userdata.administrador?f._goNextStep("administrador","usuarios"):f._goNextStep("administrador","reportes")):(b.init("operador"),f.userdata=b,f.userdata.id=parseInt(c.IdTelefonista),f.userdata.username=c.Nombre_1+" "+c.ApePaterno,f.userdata.healthCareCenters=[],f.userdata.contactCenter.id=c.Centro.Id_Centro,f.userdata.contactCenter.name=c.Centro.NombreCentro,f.userdata.limitDays=parseInt(c.Centro.LimiteDias),c.Establecimiento&&(Array.isArray(c.Establecimiento)||(c.Establecimiento=[c.Establecimiento])),c.Establecimiento.forEach(function(a){f.userdata.healthCareCenters.push({id:parseInt(a.IdNodo),idEstablecimiento:parseInt(a.Id_Establecimiento),name:a.NombreEstablecimiento})})):f.error="Usuario y/o contraseña incorrectos o expiró su contrato."},function(a){f.error="Ha ocurrido un error, porfavor notifique a su supervisor."})["finally"](function(){f.loading=!1})},f._goNextStep=function(c,d){b.save(),a.go(c||"operador",{page:d||"atencion"})}}angular.module("sdx.agenda.contacto").controller("LoginController",a),a.$inject=["$state","user","$http","RestEndpoints","toastr"]}(),function(){"use strict";function a(a,b,c,d,e){var f=this;f.user=b,f.idAttention=null,f.endAttention=function(){var a=d.open({templateUrl:"partials/operador/atencion/modal.cancelarAtencion.html",controller:"modalCancelar as cmc",windowClass:"modalAlert medium",resolve:{idAttention:function(){return b.attention.idAttention}}});a.result.then(function(){e.$emit("resetAttention")})},f.logout=function(){"operador"===a.current.name&&b.attention.idPatient?c.warning("No puedes cambiar de sección sin terminar la atención.","¡Alerta!"):(b.init({}),localStorage.user="",a.go("login"))}}angular.module("sdx.agenda.contacto").controller("header",a),a.$inject=["$state","user","toastr","$modal","$rootScope"]}(),function(){"use strict";function a(a){var b=this;b.page=a.params.page}angular.module("sdx.agenda.contacto").controller("OperadorController",a),a.$inject=["$state"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k){function l(a,b){var c=[];a.forEach(function(a){c.push(a.id)}),m(c),n()}function m(c){return o.loading=!0,o.appointments=[],f({method:"GET",url:h.obtenerAlcanceCentroContacto,params:{idCentroContacto:a.contactCenter.id,idFuncionario:a.id}}).then(function(d){var g=d.data;return g.contratoVigente?f({method:"POST",url:h.obtenerDisponibilidad,headers:{"Content-Type":"text/json"},data:JSON.stringify({FechaInicio:b("date")(new Date,"yyyyMMdd"),IdsNodo:c.join(","),IdentificadorPaciente:o.patient.id})}).then(function(a){var b=a.data;return b?(Array.isArray(b.TypeCupo)||(b.TypeCupo?b.TypeCupo=[b.TypeCupo]:b.TypeCupo=[]),b.TypeCupo.forEach(function(a){var b=parseInt(a.Fecha.substring(0,4)),c=parseInt(a.Fecha.substring(4,6))-1,d=parseInt(a.Fecha.substring(6,8)),e=parseInt(a.Hora.split(/\:/g)[1]),f=parseInt(a.Hora.split(/\:/g)[0]),h=new Date(b,c,d,f,e),i=new Date;return i.setDate(i.getDate()+g.alcance),i.setHours(23),i.setMinutes(59),i.setSeconds(59),i.setMilliseconds(59),h>i?!1:void o.appointments.push({id:parseInt(a.IdCupo),healthCareCenter:parseInt(a.IdNodo),professional:a.NombreMedico+" "+a.ApPaternoMedico,specialty:a.Especialidad,typeAttention:a.TipoAtencion,date:h})}),o.loading=!1,void o.filterAppointments()):(o.loading=!1,e.warning("Ha ocurrido un error al cargar las citas disponibles","Atención"),!1)},function(a){o.loading=!1,e.error("Ha ocurrido un error al cargar las citas disponibles")}):(e.error("El contrato de tu centro de contacto ha expirado."),o.loading=!1,a.init({}),localStorage.user="",k.go("login"),!1)},function(){o.loading=!1,e.error("Ha ocurrido un error al validar expiración del contrato")})}function n(){if(!o.patient)return!1;var b=[],c={},d=[];return o.patient.scheduledAppointments=[],o.loading=!0,f({method:"POST",url:h.obtenerCitasFuturas,headers:{"Content-Type":"text/json"},data:{IdentificadorPaciente:o.patient.id}}).then(function(g){var i=g.data;try{Array.isArray(i.TypeCita)||(i.TypeCita?i.TypeCita=[i.TypeCita]:i.TypeCita=[]),i.TypeCita.forEach(function(a){b.push(a)})}catch(j){o.loading=!1}return f({method:"POST",url:h.obtenerListaTrabajo,headers:{"Content-Type":"text/json"},data:{IdCentroContacto:a.contactCenter.id,IdTelefonista:a.id,IdPaciente:o.patient.id}}).then(function(a){var e=a.data;o.loading=!1;try{if(0===e.RespuestaBase.Estatus){e.Citas.forEach(function(a){if(!a.FechaCita)return!1;var b=parseInt(a.FechaCita.substring(0,4)),d=parseInt(a.FechaCita.substring(4,6))-1,e=parseInt(a.FechaCita.substring(6,8)),f=parseInt(a.HoraCita.split(/\:/g)[1]),g=parseInt(a.HoraCita.split(/\:/g)[0]);c[a.IdCita]={id:a.IdCita,idQuota:a.IdCupo,status:a.EstadoSonia,idCase:a.IdCaso,date:new Date(b,d,e,g,f),patient:{id:a.IdPaciente,run:a.RutPaciente,name:a.NombrePaciente,cellphone:a.MOVIL_CONTACTO||a.MOVIL_FICHA_FAMILIAR,tagCelphone:a.MOVIL_CONTACTO?"MOVIL_FICHA_FAMILIAR":a.MOVIL_FICHA_FAMILIAR?"MOVIL_FICHA_FAMILIAR":"",telephone:a.TEL1_CONTACTO||a.TEL1_FICHA_FAMILIAR,tagTelephone:a.TEL1_CONTACTO?"TEL1_FICHA_FAMILIAR":a.TEL1_FICHA_FAMILIAR?"TEL_FICHA_FAMILIAR":"",email:a.Email,telephoneAreaCode:a.TEL1_CONTACTO_CODIGO_AREA,telephoneCountryCode:a.TEL1_CONTACTO_CODIGO_PAIS},healthCareCenter:{id:a.IdNodo,name:a.Nodo},specialty:{id:a.IdEspecialidad,name:a.Especialidad},typeAttention:{id:0,name:a.TipoAtencion},professional:{id:0,name:a.Profesional}}});for(var f=0;f<b.length;f++)if(c[b[f].IdentificacionCita])d.push(c[b[f].IdentificacionCita]);else{var g=b[f],h=parseInt(g.FechaCita.substring(0,4)),i=parseInt(g.FechaCita.substring(4,6))-1,j=parseInt(g.FechaCita.substring(6,8)),k=parseInt(g.HoraCita.split(/\:/g)[1]),l=parseInt(g.HoraCita.split(/\:/g)[0]),m={id:g.IdentificacionCita,status:"Agendada",idCase:"",date:new Date(h,i,j,l,k),patient:{id:o.patient.id,run:o.patient.run,name:o.patient.name,cellphone:o.patient.cellphone,tagCelphone:o.patient.tagCelphone,telephone:o.patient.telephone,tagTelephone:o.patient.tagTelephone,email:o.patient.email},healthCareCenter:{name:g.LugarCita.NombreEstablecimiento},specialty:{name:g.Especialidad},typeAttention:{name:g.TipoAtencionCita},professional:{name:g.ProfesionalCita.Nombres+" "+g.ProfesionalCita.PrimerApellido}};d.push(m)}o.patient.scheduledAppointments=d;
}}catch(n){}},function(a){o.loading=!1,e.warning("Ha ocurrido un error al cargar las citas agendadas","Atención")})},function(a){e.warning("Ha ocurrido un error al cargar las citas agendadas","Atención")})}var o=this;if(o.appointments=[],o.filteredAppointments=[],o.healthCareCenters=a.healthCareCenters,o.specialty=[],o.professional=[],o.typeAttention=[],o.order="+date",o.filterAppointments=function(a,b){if(!o.selectedEstablishment)return!1;var d=(o.date||"").trim(),e=[];d?(d=d.split(/\//g),o.appointments.forEach(function(a){parseInt(d[2])===new Date(a.date).getFullYear()&&parseInt(d[1])-1===new Date(a.date).getMonth()&&parseInt(d[0])===new Date(a.date).getDate()&&e.push(a)})):e=o.appointments,!(o.typeAttention.length<=1&&o.professional.length<=1&&o.specialty.length<=1)||o.selectedSpecialty&&o.selectedTypeAttention&&o.selectedProfessional||a?1!==o.typeAttention.length||1!==o.professional.length||1!==o.specialty.length||o.selectedSpecialty&&o.selectedTypeAttention&&o.selectedProfessional||!a||(o.selectedSpecialty=o.specialty[0],o.selectedTypeAttention=o.typeAttention[0],o.selectedProfessional=o.professional[0]):(o.selectedSpecialty=void 0,o.selectedTypeAttention=void 0,o.selectedProfessional=void 0),b&&(o.selectedProfessional=void 0,o.selectedSpecialty=void 0,o.selectedTypeAttention=void 0),c.listAux=[],c.list=[],o.appointments.forEach(function(a){return o.selectedSpecialty!==a.specialty&&o.selectedSpecialty?!1:o.selectedTypeAttention!==a.typeAttention&&o.selectedTypeAttention?!1:o.selectedProfessional!==a.professional&&o.selectedProfessional?!1:o.selectedEstablishment.id!==a.healthCareCenter?!1:void c.listAux.push(a)}),e.forEach(function(a){return o.selectedSpecialty!==a.specialty&&o.selectedSpecialty?!1:o.selectedTypeAttention!==a.typeAttention&&o.selectedTypeAttention?!1:o.selectedProfessional!==a.professional&&o.selectedProfessional?!1:o.selectedEstablishment.id!==a.healthCareCenter?!1:void c.list.push(a)});var f=[],g={},h={},i={},j={};c.list.forEach(function(a){h[a.specialty]=!0,i[a.professional]=!0,j[a.typeAttention]=!0,g[a.specialty]||(g[a.specialty]={}),g[a.specialty][a.professional]||(g[a.specialty][a.professional]={}),g[a.specialty][a.professional][a.typeAttention]||(g[a.specialty][a.professional][a.typeAttention]=[]),g[a.specialty][a.professional][a.typeAttention].push(a)});for(var k in g)for(var l in g[k])for(var m in g[k][l])g[k][l][m].sort(function(a,b){return a.date<b.date?-1:a.date>b.date?1:0}),f.push(g[k][l][m]);var n=[];f.forEach(function(a){n.push({professional:a[0].professional,specialty:a[0].specialty,typeAttention:a[0].typeAttention,date:a[0].date,appointments:a})}),f=n,o.filteredAppointments=f,o.appointmentSelected=void 0,o.typeAttention=[],o.specialty=[],o.professional=[];for(var k in j)o.typeAttention.push(k);for(var k in h)o.specialty.push(k);for(var k in i)o.professional.push(k);-1===o.typeAttention.indexOf(o.selectedTypeAttention)&&(o.selectedTypeAttention=void 0),-1===o.specialty.indexOf(o.selectedSpecialty)&&(o.selectedSpecialty=void 0),-1===o.professional.indexOf(o.selectedProfessional)&&(o.selectedProfessional=void 0)},o.searchPatient=function(){return o.error="",o.loading?!1:o.patient?!1:o.idPatient?(o.rutFormat(),b("RunFormatFilter")(o.idPatient,"validate")?(o.loading=!0,f({method:"POST",url:h.buscarPaciente,headers:{"Content-Type":"text/json"},data:JSON.stringify({Rut:o.idPatient.replace(/[\-\.]/g,"").trim()})}).then(function(b){var c=b.data;if(parseInt(c.Id_Paciente)){for(var d={id:parseInt(c.Id_Paciente),name:c.Nombres+" "+c.Ap_Paterno+" "+c.Ap_Materno,healthCareCenter:parseInt(c.Id_nodo),run:c.Rut,email:c.Email,birthday:c.FechaNacimiento.split(/\s/)[0].replace(/\-/g,"/"),telephone:c.Tel_Contacto||c.Tel_Ficha_Familiar,tagTelephone:c.Tel_Contacto?"TEL1_FICHA_FAMILIAR":c.Tel_Ficha_Familiar?"TEL_FICHA_FAMILIAR":"",cellphone:c.Movil_Contacto||c.Movil_Ficha_Familiar,tagCelphone:c.Movil_Contacto?"MOVIL_FICHA_FAMILIAR":c.Movil_Ficha_Familiar?"MOVIL_FICHA_FAMILIAR":"",scheduledAppointments:[]},g=0;g<o.healthCareCenters.length;g++)if(o.healthCareCenters[g].id===d.healthCareCenter){o.selectedEstablishment=o.healthCareCenters[g];break}return o.selectedEstablishment||(o.loading=!1,e.warning("Paciente no pertenece a ningún establecimiento asociado.")),o.patient=d,f({method:"POST",url:h.crearCaso,headers:{"Content-Type":"text/json"},data:{IdCreador:a.id,IdPaciente:parseInt(c.Id_Paciente)}}).then(function(b){var d=b.data;parseInt(d.IdCaso)?(o.loading=!1,o.error="",o.idAttention=parseInt(d.IdCaso),l(o.healthCareCenters,c.Id_Paciente),a.attention.idPatient=o.idPatient,a.attention.idAttention=o.idAttention,a.attention.patient=o.patient,a.save(),o.filterAppointments()):e.warning("Ha ocurrido un error al crear el caso","Atención")},function(a){e.warning("Ha ocurrido un error al crear el caso","Atención")})}o.error="No se logro encontrar un paciente con esa identificación"},function(a){e.warning("Ha ocurrido un error al buscar al paciente","Atención")})["finally"](function(){o.loading=!1})):(o.error="El identificador no tiene el formato correcto.",j(function(){o.error=""},5e3),!1)):(o.error="El número de identificación se encuentra vacío.",j(function(){o.error=""},5e3),!1)},o.reset=function(){o.patient=void 0,o.appointments=[],o.idPatient=void 0,o.idAttention=void 0,o.professional=[],o.date=void 0,o.specialty=[],o.typeAttention=[],o.selectedEstablishment=void 0,o.filteredAppointments=[],a.attention={},a.save()},g.$on("resetAttention",function(){o.reset()}),o.endAttention=function(a){var b=d.open({templateUrl:"partials/operador/atencion/modal.confirmar.html",controller:"modalConfirmar",controllerAs:"mc",bindToController:!0,windowClass:"modalAlert largee",resolve:{idAttention:function(){return o.idAttention},patient:function(){return o.patient},appointments:function(){return a}}});b.result.then(function(){o.reset()},function(){})},o.rutFormat=function(){o.idPatient=b("RunFormatFilter")(o.idPatient)},g.$on("filterAttention",function(a,b){o.date=b,g.$apply(function(){o.filterAppointments()})}),o.editAttentionAppointment=function(b){var c=d.open({templateUrl:"../scripts/globals/modals/editAppointment/editAppointment.modal.html",controller:"modalEditAppointment",controllerAs:"eamc",windowClass:"agenda-modal",resolve:{appointment:function(){return b},appointments:function(){return o.patient.scheduledAppointments},callbacks:function(){return{emailEdit:function(b){a.attention.patient.email=b,a.save()},telephoneEdit:function(b){a.attention.patient.telephone=b,a.save()},cellphoneEdit:function(b){a.attention.patient.cellphone=b,a.save()}}}}});c.result.then(function(){n()})},a.attention.idPatient){o.idAttention=a.attention.idAttention,o.idPatient=a.attention.idPatient,o.patient=a.attention.patient;for(var p=0;p<o.healthCareCenters.length;p++)if(o.healthCareCenters[p].id===o.patient.healthCareCenter){o.selectedEstablishment=o.healthCareCenters[p];break}o.selectedEstablishment||(e.warning("Paciente no pertenece a ningún establecimiento asociado.","Atención"),o.selectedEstablishment=o.healthCareCenters[0]),l(o.healthCareCenters,a.attention.idPatient)}}angular.module("sdx.agenda.contacto").controller("AtencionController",a),a.$inject=["user","$filter","appointmentsDrive","$modal","toastr","$http","$rootScope","RestEndpoints","$q","$timeout","$state"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k){var l=this,m=1;l.searchText="",l.pendingAppointmentsFiltered=[],l.pendingAppointments=[],l.appointmentSelected=void 0,l.filters={status:"",healthCareCenterValues:[],healthCareCenter:""},l.order={current:"date",order:"asc"},l.crono={minutes:{current:"00",def:localStorage.cronominutes||"10"},seconds:{current:"00",def:localStorage.cronoseconds||"00"},interval:null,init:function(){l.crono.minutes.current=l.crono.minutes.def,l.crono.seconds.current=l.crono.seconds.def,l.crono.interval=f(function(){"lista"===h.params.page&&("00"===l.crono.seconds.current?"00"===l.crono.minutes.current?l.refreshList():(l.crono.minutes.current=(parseInt(l.crono.minutes.current)-1<10?"0":"")+(parseInt(l.crono.minutes.current)-1),l.crono.seconds.current="59"):l.crono.seconds.current=(parseInt(l.crono.seconds.current)-1<10?"0":"")+(parseInt(l.crono.seconds.current)-1))},1e3)},edit:function(){var a=b.open({templateUrl:"cronoModal.html",controller:"cronoController",windowClass:"modalAlert small",resolve:{crono:function(){return l.crono}}});a.result.then(function(){},function(){})}},l.crono.init();var n={},o={};l.refreshList=function(){l.crono.minutes.current=l.crono.minutes.def,l.crono.seconds.current=l.crono.seconds.def,m=1,l.pendingAppointmentsFiltered=[],l.pendingAppointments=[],l.filters.healthCareCenterValues=[],l.loading=!0,k.obtenerAlcance(d).then(function(){return c({method:"POST",url:e.obtenerListaTrabajo,headers:{"Content-Type":"text/json"},data:JSON.stringify({IdCentroContacto:d.contactCenter.id,IdTelefonista:d.id})})},function(){i.error("El contrato de tu centro de contacto ha expirado."),h.go("login")}).then(function(b){var f=b.data;if(0!==f.RespuestaBase.Estatus)return j.reject(f.RespuestaBase.Descripcion);o={},n={},f.Citas.forEach(function(b){if(!b.FechaCita)return!1;var c=parseInt(b.FechaCita.substring(0,4)),d=parseInt(b.FechaCita.substring(4,6))-1,e=parseInt(b.FechaCita.substring(6,8)),f=parseInt(b.HoraCita.split(/\:/g)[1]),g=parseInt(b.HoraCita.split(/\:/g)[0]);return o[b.Nodo]||(o[b.Nodo]=!0,l.filters.healthCareCenterValues.push(b.Nodo)),new Date(c,d,e,g,f)<=new Date?!1:void(n[b.IdCita]={search:!1,id:b.IdCita,idQuota:b.IdCupo,status:b.EstadoSonia,idCase:b.IdCaso,date:new Date(c,d,e,g,f),patient:{id:b.IdPaciente,run:b.RutPaciente,name:b.NombrePaciente,cellphone:b[a.cellphone.label],telephone:b[a.telephone.label],telephoneAreaCode:b.TEL1_CONTACTO_CODIGO_AREA,telephoneCountryCode:b.TEL1_CONTACTO_CODIGO_PAIS,email:b.Email},healthCareCenter:{id:b.IdNodo,name:b.Nodo},specialty:{id:b.IdEspecialidad,name:b.Especialidad},typeAttention:{id:0,name:b.TipoAtencion},professional:{id:0,name:b.Profesional}})});var g=[];return d.healthCareCenters.forEach(function(a){g.push(a.id)}),c({method:"POST",url:e.obtenerCitasAgendadas,headers:{"Content-Type":"text/json"},data:JSON.stringify({IdsNodo:g.join(",")})})}).then(function(b){var c=b.data;c.Citas||(c.Citas={});var d=c.Citas.TypeCitasAgendadas?Array.isArray(c.Citas.TypeCitasAgendadas)?c.Citas.TypeCitasAgendadas:[c.Citas.TypeCitasAgendadas]:[];d.forEach(function(b){if(n[b.Id_Cita])return!1;if(!b.Fecha_Cita)return!1;var c=parseInt(b.Fecha_Cita.substring(0,4)),d=parseInt(b.Fecha_Cita.substring(4,6))-1,e=parseInt(b.Fecha_Cita.substring(6,8)),f=parseInt(b.Hora_Cita.split(/\:/g)[1]),g=parseInt(b.Hora_Cita.split(/\:/g)[0]);o[b.Nodo]||(o[b.Nodo]=!0,l.filters.healthCareCenterValues.push(b.Nodo)),n[b.Id_Cita]={itemId:0,search:!1,id:b.Id_Cita,status:"Agendada",idCase:"",date:new Date(c,d,e,g,f),patient:{id:b.Id_Paciente,run:b.Rut_Paciente,name:b.Nombre_Paciente,cellphone:b[a.cellphone.label],telephone:b[a.telephone.label],email:b.Email},healthCareCenter:{name:b.Nodo},specialty:{name:b.Especialidad},typeAttention:{name:b.TipoAtencion},professional:{name:b.Profesional}}}),l.pendingAppointments=Object.values(n).sort(function(a,b){return a.date<b.date?-1:a.date>b.date?1:0}),l.filter(),l.pendingAppointments.forEach(function(a){a.itemId=m++}),l.searchAppointments(l.searchText)})["catch"](function(a){i.error(a||"Ha ocurrido un error al validar expiración del contrato")})["finally"](function(){l.loading=!1})},l.filter=function(){var a=l.pendingAppointments,b=[];a.forEach(function(a){return l.filters.status&&l.filters.status!==a.status?!1:l.filters.healthCareCenter&&l.filters.healthCareCenter!==a.healthCareCenter.name?!1:void b.push(a)}),l.pendingAppointmentsFiltered=b},l.openEditAppointment=function(a){var c=b.open({templateUrl:"../scripts/globals/modals/editAppointment/editAppointment.modal.html",controller:"modalEditAppointment",controllerAs:"eamc",windowClass:"agenda-modal",resolve:{appointment:function(){return a},appointments:function(){return l.pendingAppointments}}});c.result.then(function(){l.refreshList()})},l.searchAppointments=function(a){a.length>=3&&l.pendingAppointments.forEach(function(b){var c=new RegExp(a,"gi");b.search=c.test(b.id)||c.test(b.professional.name)||c.test(b.patient.name)||c.test(b.specialty.name)||c.test(b.typeAttention.name)||c.test(g("NameOfDayFilter")(g("date")(b.date,"EEEE")))||c.test(g("date")(b.date,"dd/MM/yyyy HH:mm"))||c.test(b.healthCareCenter.name)||c.test(b.patient.telephone)||c.test(b.patient.cellphone)||c.test(b.idCase?"Web":"Presencial")})},l.orderBy=function(a){l.order.order=l.order.current===a&&"asc"!==l.order.order?"asc":"desc",l.order.current=a,l.pendingAppointmentsFiltered.sort(function(b,c){var d,e;return"patient"===a?(d=b.patient.name,e=c.patient.name):"date"===a?(d=b.date,e=c.date):"specialty"===a?(d=b.specialty.name,e=c.specialty.name):"typeAttention"===a?(d=b.typeAttention.name,e=c.typeAttention.name):"status"===a&&(d=b.status,e=c.status),"desc"===l.order.order?e>d?1:d>e?-1:0:e>d?-1:d>e?1:0})},l.exportToExcel=function(){var a=$("table")[0].cloneNode(!0),b="\ufeff";$(a).find("th").each(function(){b+=("\n"===b.substring(b.length-1,b.length)||""===b.substring(b.length-1,b.length)||"\ufeff"===b.substring(b.length-1,b.length)?"":";")+'"'+$(this).text().replace(/[\t\n]/g,"").trim()+'"'}),b+="\n",$(a).find("tbody tr").each(function(){var a=$(this);a.find("td:eq(3)").remove(),a.find("td:eq(8)").text(a.find("td:eq(8) img").attr("title")),a.find("td").each(function(){b+=("\n"===b.substring(b.length-1,b.length)||""===b.substring(b.length-1,b.length)||"\ufeff"===b.substring(b.length-1,b.length)?"":";")+'"'+$(this).text().replace(/[\t\n]/g,"").trim()+'"'}),b+="\n"});var c=new Blob([b],{type:"application/octet-stream"}),d=document.createElement("a");d.href=window.URL.createObjectURL(c),d.download="Lista de trabajo.csv",d.click()}}function b(a,b,c){a.minutes=parseInt(b.minutes.def),a.seconds=parseInt(b.seconds.def),a.change=function(a,c){b[a].def=localStorage["crono"+a]=(parseInt(c||"0")<10?"0":"")+(c||"0"),b.minutes.current=b.minutes.def,b.seconds.current=b.seconds.def},a.salir=function(){c.dismiss("cancel")}}angular.module("sdx.agenda.contacto").controller("ListaTrabajoController",a).controller("cronoController",b),a.$inject=["PhoneTypes","$modal","$http","user","RestEndpoints","$interval","$filter","$state","toastr","$q","CentrosContactoService"],b.$inject=["$scope","crono","$modalInstance"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){var i=this;i.appointments=h,i.idAttention=b,i.appointmentSelected=null,i.loading=!1,i.ok=function(){return i.loading=!0,d({method:"POST",url:e.notificarCitaNueva,headers:{"Content-Type":"text/json"},data:{FechaEnteraCupo:f("date")(new Date(i.appointmentSelected.date),"yyyyMMdd"),IdCupo:i.appointmentSelected.id,IdPaciente:c.id,IdNodo:i.appointmentSelected.healthCareCenter.toString(),Fecha:f("date")(new Date(i.appointmentSelected.date),"yyyy-MM-dd HH:mm")}}).then(function(b){var c=b.data,d=parseInt(c.RespuestaBase.Estatus);return 0===d?(g.success("Cita agendada con éxito","Atención"),a.close({IdentificadorCita:b.data.IdentificadorCita,IdCaso:b.data.IdCaso,IdCupo:b.data.IdCupo})):(g.warning(c.RespuestaBase.Descripcion),void(i.loading=!1))},function(a){g.warning("Ha ocurrido un error al agendar la cita","Atención"),i.loading=!1})},i.salir=function(){a.dismiss("cancel")}}function b(a,b,c,d,e,f){var g=this;g.idAttention=d,g.motivo="Llamada interrumpida",g.motivoText="",g.error="",g.loading=!1,g.save=function(){var h=g.motivo,i=g.motivoText;if(("otro"===h||"rechazo"===h)&&(i||"").length<10)return g.error="El texto debe de tener minimo 10 caracteres.",f(function(){g.error=""},5e3),!1;var j=null,k=null;return"9"===h?(j={IdCaso:d,IdRespuesta:9,DetalleRespuesta:"Sin citas disponibles"},k=e.cerrarCaso):"rechazo"===h?(j={IdCaso:d,IdMotivoRechazo:4,DetalleRechazo:i},k=e.rechazarCita):(j={IdCaso:d,IdRespuesta:13,DetalleRespuesta:"otro"!==h?h:i},k=e.cerrarCaso),g.error="",g.loading=!0,b({method:"POST",url:k,headers:{"Content-Type":"text/json"},data:j}).then(function(b){var d=b.data.RespuestaBase;0===d.Estatus?(c.success("La atención ha sido cancelada correctamente.","Cancelar atención"),a.close()):(c.warning("Ha ocurrido un error al cancelar la atención","Cancelar atención"),g.loading=!1)},function(a){c.warning("Ha ocurrido un error al cancelar la atención","Cancelar atención"),g.loading=!1})},g.salir=function(){a.dismiss("cancel")}}angular.module("sdx.agenda.contacto").controller("modalConfirmar",a).controller("modalCancelar",b),a.$inject=["$modalInstance","idAttention","patient","$http","RestEndpoints","$filter","toastr","appointments"],b.$inject=["$modalInstance","$http","toastr","idAttention","RestEndpoints","$timeout"]}(),function(){"use strict";function a(a,b,c,d,e,f,g){var h=this;h.user=f,h.users=[],h.userTextSearch="",h.healthCareCenters=[],h.contactCenters=g,h.filters={contactCenter:void 0,user:void 0,healthCareCenter:void 0},h.userChangedData={user:"",pass:"",pass2:"",name:"",name2:"",run:"",run2:"",lastName:"",lastName2:"",date:"",contactCenter:"",isSupervisor:!1,isAdministrator:!1,isActive:!0},h.refreshData=function(d){"contactCenter"===d?(h.users=[],a({method:"POST",url:b.obtenerContratos,headers:{"Content-Type":"text/json"},data:JSON.stringify({IdCentro:h.filters.contactCenter.Id_Centro})}).then(function(a){var b=a.data;if(0===b.RespuestaBase.Estatus){var d=[];b.Contratos.forEach(function(a){d.push({id:a.IdTelefonista,user:a.NombreUsuario,name:a.NombreTelefonista+" "+a.ApPaternoTel+" "+a.ApMaternoTel,name1:a.NombreTelefonista,name2:a.SegundoNombreTelefonista,lastName:a.ApPaternoTel,lastName2:a.ApMaternoTel,isActive:a.Activo,isDelete:a.Eliminado,isSupervisor:a.EsSupervisor,isAdministrator:a.EsAdministrador,healthCareCenters:a.Establecimientos,run:e("RunFormatFilter")(a.Rut),run2:a.Rut,date:a.FechaNacimiento.split(/\s/g)[0].replace(/\-/g,"/")})}),h.users=d}else c.warning("Ha ocurrido un error al cargar los usuarios")},function(a){c.warning("Ha ocurrido un error al cargar los usuarios")})):"user"===d&&(h.healthCareCenters=[],h.loading=!0,a.get(b.obtenerEstablecimiento).then(function(a){var b=a.data;if(0===b.RespuestaBase.Estatus){for(var d=[],e={},f=0;f<h.filters.user.healthCareCenters.length;f++)e[h.filters.user.healthCareCenters[f].NombreEstablecimiento]=!0;b.Establecimientos.forEach(function(a){e[a.NombreEstablecimiento]||d.push(a)}),h.healthCareCenters=d}else c.warning("Ha ocurrido un error al cargar los establecimientos","Atención");h.loading=!1},function(){c.warning("Ha ocurrido un error al cargar los establecimientos","Atención"),h.loading=!1}))},h.init=function(){if(h.user.contactCenter.id){var a=parseInt(h.user.contactCenter.id);h.contactCenters.forEach(function(b){a===b.Id_Centro&&(h.filters.contactCenter=b)}),h.refreshData("contactCenter")}},h.changeEstablishment=function(d,e){if("add"===e){for(var f=0;f<h.healthCareCenters.length;f++)if(d===h.healthCareCenters[f].NombreEstablecimiento){d=h.healthCareCenters[f];break}if("undefined"==typeof d||"string"==typeof d)return c.warning("Nombre de establecimiento incorrecto.","Atención"),!1}a({method:"POST",url:b.actualizarContrato,headers:{"Content-Type":"text/json"},data:JSON.stringify({idTelefonista:h.filters.user.id,idEstablecimiento:d.Id_Establecimiento,accion:"delete"===e?2:1})}).then(function(a){var b=a.data;0===b.RespuestaBase.Estatus?"add"===e?(h.filters.healthCareCenter=void 0,h.healthCareCenters.forEach(function(a,b){a.NombreEstablecimiento===d.NombreEstablecimiento&&h.healthCareCenters.splice(b,1)}),h.filters.user.healthCareCenters.push(d)):"delete"===e&&(h.filters.user.healthCareCenters.forEach(function(a,b){a.NombreEstablecimiento===d.NombreEstablecimiento&&h.filters.user.healthCareCenters.splice(b,1)}),h.healthCareCenters.push(d)):c.warning("Ha ocurrido un error","Atención")},function(){c.warning("Ha ocurrido un error","Atención")})},h.loadChangedData=function(){h.userChangedData={user:h.filters.user.user,pass:"",pass2:"",name:h.filters.user.name1,name2:h.filters.user.name2,run:h.filters.user.run,run2:h.filters.user.run2,lastName:h.filters.user.lastName,lastName2:h.filters.user.lastName2,date:h.filters.user.date,contactCenter:h.filters.contactCenter,isActive:h.filters.user.isActive?!0:!1,isSupervisor:h.filters.user.isSupervisor?!0:!1,isAdministrator:h.filters.user.isAdministrator?!0:!1}},h.changeData=function(){h.loading=!0;var d=h.userChangedData,f={IdTelefonista:h.filters.user.id};if(d.user&&d.user!==h.filters.user.user&&(f.Login=d.user),d.pass){if(d.pass!==d.pass2)return c.warning("Las contraseñas no coinciden.","Atención"),h.loading=!1,!1;f.Password=d.pass}if(d.name&&d.name!==h.filters.user.name1&&(f.Nombre1=d.name),d.name2&&d.name2!==h.filters.user.name2&&(f.Nombre2=d.name2),d.run&&d.run!==h.filters.user.run){if(!e("RunFormatFilter")(d.run,"validate"))return c.warning("El RUN tiene un formato incorrecto.","Atención"),h.loading=!1,!1;f.Rut=d.run.replace(/[\.]/g,"")}if(d.lastName&&d.lastName!==h.filters.user.lastName&&(f.ApPaterno=d.lastName),d.lastName2&&d.lastName2!==h.filters.user.lastName2&&(f.ApMaterno=d.lastName2),d.date){for(var g=d.date.split(/\//g),i="",j=g.length-1;j>=0;j--)i+=g[j];f.FechaNacimiento=i}if(h.user.contactCenter.id)f.IdCentroContacto=parseInt(h.user.contactCenter.id);else if(d.contactCenter){for(var k="",j=0;j<h.contactCenters.length;j++)h.contactCenters[j].NombreCentro===d.contactCenter.NombreCentro&&(k=h.contactCenters[j].Id_Centro);if(""===k)return c.warning("Centro de contacto desconocido.","Atención"),h.loading=!1,!1;f.IdCentroContacto=k}f.EsSupervisor=d.isSupervisor?1:0,f.EsAdministrador=d.isAdministrator?1:0,f.Activo=d.isActive?1:0,a({method:"POST",url:b.actualizarTelefonista,headers:{"Content-Type":"text/json"},data:JSON.stringify(f)}).then(function(a){var b=a.data;0===b.RespuestaBase.Estatus?(h.refreshData("contactCenter"),h.userTextSearch=h.filters.user.name+" ("+h.filters.user.run.replace(/\./g,"")+")",h.loading=!1,c.success("El usuario fue editado correctamente.","Información")):57===b.RespuestaBase.Estatus?(h.loading=!1,c.warning("El nombre de usuario y/o RUN ya se encuentra registrado.")):(h.loading=!1,c.error("Ha ocurrido un error al intentar actualizar datos del usuario"))},function(){h.loading=!1,c.error("Ha ocurrido un error al intentar actualizar datos del usuario")})},h.runFormat=function(){h.userChangedData.run=e("RunFormatFilter")(h.userChangedData.run)},h.openModalCreateUser=function(){var a=d.open({templateUrl:"modalCreateUser.html",controller:"modalCreateUser",windowClass:"modalAlert mediumm",resolve:{centros:function(){return g}}});a.result.then(function(){h.init()})},h.init()}function b(a,b,c,d,e,f,g){a.user=e,a.loading=!1,a.form={user:"",pass:"",pass2:"",name:"",name2:"",lastName:"",lastName2:"",run:"",date:"",contactCenter:"",isSupervisor:!1,isAdministrator:!1},a.contactCenters=f,a.ok=function(){if(a.form.pass!==a.form.pass2)return c.warning("Las contraseñas no coinciden.","Atención"),!1;if(!d("RunFormatFilter")(a.form.run,"validate"))return c.warning("El RUN tiene un formato incorrecto.","Atención"),!1;var f="";if(!/^[0-9]{2}\/[0-9]{2}\/[0-9]{4}$/.test(a.form.date))return c.warning("Fecha de nacimiento incorrecta.","Atención"),!1;for(var h=a.form.date.split(/\//g),i=h.length-1;i>=0;i--)f+=h[i];var j="";if(e.contactCenter.id)j=parseInt(e.contactCenter.id);else{for(var i=0;i<a.contactCenters.length;i++)a.contactCenters[i].NombreCentro===a.form.contactCenter&&(j=a.contactCenters[i].Id_Centro);if(""===j)return c.warning("Centro de contacto desconocido.","Atención"),!1}a.loading=!0,g.crear(j,a.form,f).then(function(d){0!==d.Estatus?c.error(d.Descripcion,"Telefonista"):c.success("El usuario fue creado correctamente.","Telefonista"),a.loading=!1,b.close()},function(a){c.error(a,"Telefonista")})["finally"](function(){a.loading=!1})},a.salir=function(){b.dismiss("cancel")},a.runFormat=function(){a.form.run=d("RunFormatFilter")(a.form.run)}}angular.module("sdx.agenda.contacto").controller("ContratoController",a).controller("modalCreateUser",b),a.$inject=["$http","RestEndpoints","toastr","$modal","$filter","user","centros"],b.$inject=["$scope","$modalInstance","toastr","$filter","user","centros","TelefonistaService"]}(),function(){"use strict";function a(a,b,c,d,e,f,g){var h=this;h.user=e,h.loading=!1,h.contactCenter={},h.contactCenters=f,h.dataChange={id:0,name:"",limit:1},h.getContactCenters=function(){h.user.contactCenter.id&&(h.contactCenters.forEach(function(a){parseInt(h.user.contactCenter.id)===a.Id_Centro&&(h.contactCenter=a)}),h.selectContactCenter(h.contactCenter))},h.selectContactCenter=function(a){h.dataChange={id:a.Id_Centro,name:a.NombreCentro,limit:a.LimiteDias,expiration:a.FechaCaducidad.split(/\s/g)[0].replace(/\-/g,"/")}},h.changeDataContactCenter=function(){h.loading=!0;var a={IdCentroContacto:h.dataChange.id};if(h.dataChange.name&&h.dataChange.name!==h.contactCenter.NombreCentro&&(a.NombreCentroContacto=h.dataChange.name),h.dataChange.limit&&h.dataChange.limit!==h.contactCenter.LimiteDias&&(a.LimiteDias=h.dataChange.limit),!/^[0-9]{2}\/[0-9]{2}\/[0-9]{4}$/.test(h.dataChange.expiration))return d.warning("Fecha de expiración incorrecta.","Atención"),h.loading=!1,!1;for(var e=h.dataChange.expiration.split(/\//g),f="",i=e.length-1;i>=0;i--)f+=e[i];return a.FechaCaducidad=f,b({method:"POST",url:c.actualizarCentroContacto,headers:{"Content-Type":"text/json"},data:JSON.stringify(a)}).then(function(a){var b=a.data;return 0===b.RespuestaBase.Estatus?(d.success("Los datos fueron editados correctamente.","Centro de Contacto"),g.getList(!0).then(function(){h.loading=!1})):(d.warning("Ha ocurrido un error","Centro de Contacto"),void(h.loading=!1))},function(){d.warning("Ha ocurrido un error","Centro de Contacto"),h.loading=!1})},h.openModalCreateContactCenter=function(){var b=a.open({templateUrl:"modalCreateContactCenter.html",controller:"modalCreateContactCenter",windowClass:"modalAlert mediumm"});b.result.then(function(){h.getContactCenters()})}}function b(a,b,c,d,e){b.form={name:"",limitDays:"31",otherDay:1,expiration:""},b.loading=!1,b.ok=function(){b.loading=!0;var f;if(!/^[0-9]{2}\/[0-9]{2}\/[0-9]{4}$/.test(b.form.expiration))return e.warning("Fecha de expiración incorrecta.","Atención"),b.loading=!1,!1;var g=b.form.expiration.split(/\//g);f="";for(var h=g.length-1;h>=0;h--)f+=g[h];c({method:"POST",url:d.crearCentroContacto,headers:{"Content-Type":"text/json"},data:JSON.stringify({NombreCentroContacto:b.form.name,LimiteDias:b.form.limitDays||b.form.otherDay,FechaCaducidad:f})}).then(function(b){var c=b.data;0===c.RespuestaBase.Estatus?(e.success("El centro de contacto fue creado correctamente."),a.close()):52===c.RespuestaBase.Estatus?e.warning("Ya existe un centro de contacto con ese nombre."):e.error("Ha ocurrido un error")},function(){e.error("Ha ocurrido un error")})["finally"](function(){b.loading=!1})},b.salir=function(){a.dismiss("cancel")}}angular.module("sdx.agenda.contacto").controller("CentroDeContactoController",a).controller("modalCreateContactCenter",b),a.$inject=["$modal","$http","RestEndpoints","toastr","user","centros","CentrosContactoService"],b.$inject=["$modalInstance","$scope","$http","RestEndpoints","toastr"]}(),function(){"use strict";function a(a,b,c,d,e){var f=this;f.user=b,f.citasAgendadasYnoAgendadas={inicio:"",termino:"",nodos:{}},f.getReportURL=function(g){if("datosGenerales"===g&&f.citasAgendadasYnoAgendadas.nodos&&f.citasAgendadasYnoAgendadas.inicio&&f.citasAgendadasYnoAgendadas.termino){f.loading=!0;var h=Object.keys(f.citasAgendadasYnoAgendadas.nodos).filter(function(a){return!!f.citasAgendadasYnoAgendadas.nodos[a]}).join(",");return h.length?d({method:"GET",url:a.obtenerCitasPorFiltro,params:{idFuncionario:b.id,nodos:h,inicio:f.citasAgendadasYnoAgendadas.inicio,termino:f.citasAgendadasYnoAgendadas.termino}}).then(function(b){var c=f.citasAgendadasYnoAgendadas.inicio.split(/\//g),d=c[2]+"-"+c[1]+"-"+c[0]+"T00:00:00"+e,g=f.citasAgendadasYnoAgendadas.termino.split(/\//g),h=g[2]+"-"+g[1]+"-"+g[0]+"T00:00:00"+e,i=a.jasperServer+"AgendaWeb/Horas_agendadas.pdf?j_username=reportesUrgencia&j_password=reportesUrgencia&INICIO="+d+"&TERMINO="+h+"&NOCONFIRMADAS="+b.data.noConfirmadas+"&CONFIRMADAS="+b.data.confirmadas;window.open(i,"_blank")},function(){c.warning("Ocurrio un problema con el servidor.")})["finally"](function(){f.loading=!1}):(c.warning("Debes de elegir como mínimo un establecimiento."),f.loading=!1,!1)}}}angular.module("sdx.agenda.contacto").controller("reporteria",a),a.$inject=["RestEndpoints","user","toastr","$http","TIME_ZONE"]}(),function(){"use strict";function a(a){function b(a,b){var c;for(c in a)"function"!=typeof a[c]&&delete a[c];for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}var c={operador:{id:"",type:"operador",username:"",healthCareCenters:[],healthCareCenter:{},attention:{},contactCenter:{id:0,name:""}},administrador:{id:"",type:"administrador",healthCareCenters:[],username:""}};this.init=function(a){"string"==typeof a?b(this,c[a]):"object"==typeof a&&b(this,a)},this.save=function(){localStorage.user=a.encode(JSON.stringify(this,function(a,b){return/^\$\$/.test(a)?void 0:b}))}}angular.module("sdx.agenda.contacto").service("user",a),a.$inject=["$base64"]}(),function(){function a(a,b,c){var d=this;return d.centros=[],d.loaded=!1,d.loadFromAPI=function(){return b.get(a.obtenerCentroContacto).then(function(a){var b=a.data;return 0!==b.RespuestaBase.Estatus&&c.reject(b.RespuestaBase.Descripcion),d.centros=b.Centros,d.loaded=!0,d.centros})},{getList:function(a){return!d.loaded||a?d.loadFromAPI():c.resolve(d.centros)},obtenerAlcance:function(d){return b({method:"GET",url:a.obtenerAlcanceCentroContacto,params:{idCentroContacto:d.contactCenter.id,idFuncionario:d.id}}).then(function(a){var b=a.data;return b&&!b.contratoVigente?(d.init({}),localStorage.user="",c.reject()):!0})}}}angular.module("sdx.agenda.contacto").factory("CentrosContactoService",a),a.$inject=["RestEndpoints","$http","$q"]}(),function(){function a(a,b,c){return{crear:function(d,e,f){return a({method:"POST",url:b.crearTelefonista,headers:{"Content-Type":"text/json"},data:JSON.stringify({IdCentroContacto:d,Login:e.user,Password:e.pass,Rut:e.run.replace(/[\.]/g,""),Nombre1:e.name,Nombre2:e.name2,ApPaterno:e.lastName,ApMaterno:e.lastName2,FechaNacimiento:f,EsSupervisor:e.isSupervisor?1:0,EsAdministrador:e.isAdministrator?1:0})}).then(function(a){var b=a.data;return 0!==b.RespuestaBase.Estatus&&c.reject(b.RespuestaBase.Descripcion),b.RespuestaBase})}}}angular.module("sdx.agenda.contacto").factory("TelefonistaService",a),a.$inject=["$http","RestEndpoints","$q"]}(),function(){"use strict";function a(a,b,c){return{link:function(d,e,f){$(e).fdatepicker({language:"es",weekStart:1,format:"dd/mm/yyyy",onRender:function(b){var c;if(f.fDatepicker)return f.dateLimit&&"today"===f.dateLimit&&(c=new Date,c.setHours(23),c.setMinutes(59),c.setSeconds(59),b>c)?"disabled":"";for(var d=0;d<a.listAux.length;d++){var e=a.listAux[d].date;if("string"==typeof e&&(e=new Date(e)),c=new Date(e),c.setDate(c.getDate()-1),b.getFullYear()===c.getFullYear()&&b.getMonth()===c.getMonth()&&b.getDate()===c.getDate())return""}return"disabled"}}).on("changeDate",function(a){if(f.fDatepicker){var g=f.ngModel.split(/\./g),h=g.pop(),i=c(g.join("."))(d);i[h]=$(e).val()}b.$emit("filterAttention",$(e).val())})}}}angular.module("sdx.agenda.contacto").directive("fDatepicker",a),a.$inject=["appointmentsDrive","$rootScope","$parse"]}(),function(){"use strict";function a(){return{link:function(a,b,c){$(b).click(function(){$("input#"+c.focusInput).focus()})}}}angular.module("sdx.agenda.contacto").directive("focusInput",a),a.$inject=[]}();